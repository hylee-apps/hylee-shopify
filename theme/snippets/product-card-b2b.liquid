{% comment %}
  Product Card B2B Snippet
  Extended product card for B2B/wholesale features

  Parameters:
    - product: Product object (required)
    - show_vendor: Display vendor name (default: true)
    - show_quick_add: Show quick add to cart button (default: true)
    - show_rating: Show product rating (default: true)
    - show_secondary_image: Show secondary image on hover (default: true)
    - show_discount_percentage: Show percentage off badge (default: true)
    - lazy_load: Lazy load images (default: true)
    - custom_badge: Custom badge text
    - custom_badge_color: Custom badge background color (default: #2699A6)
    - card_class: Additional CSS classes for the card

  B2B Specific Parameters:
    - show_bulk_pricing: Show bulk pricing info (default: true)
    - bulk_threshold: Quantity for bulk discount (default: 10)
    - bulk_discount: Bulk discount percentage (default: 15)
    - min_order_qty: Minimum order quantity (default: 1)
    - show_supplier: Show supplier info (default: true)
    - supplier_name: Supplier/vendor name (uses product.vendor if not set)
    - supplier_location: Supplier location text
    - free_shipping_threshold: Order amount for free shipping (default: 50)
    - show_free_shipping: Show free shipping badge (default: true)
{% endcomment %}

{% liquid
  assign show_vendor = show_vendor | default: true
  assign show_quick_add = show_quick_add | default: true
  assign show_rating = show_rating | default: true
  assign show_secondary_image = show_secondary_image | default: true
  assign show_discount_percentage = show_discount_percentage | default: true
  assign lazy_load = lazy_load | default: true
  assign custom_badge = custom_badge | default: null
  assign custom_badge_color = custom_badge_color | default: '#2699A6'
  assign card_class = card_class | default: ''

  assign show_bulk_pricing = show_bulk_pricing | default: true
  assign bulk_threshold = bulk_threshold | default: 10
  assign bulk_discount = bulk_discount | default: 15
  assign min_order_qty = min_order_qty | default: 1
  assign show_supplier = show_supplier | default: true
  assign supplier_name = supplier_name | default: product.vendor
  assign supplier_location = supplier_location | default: null
  assign free_shipping_threshold = free_shipping_threshold | default: 50
  assign show_free_shipping = show_free_shipping | default: true

  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  assign sold_out = true
  if product.available
    assign sold_out = false
  endif

  assign discount_percentage = 0
  if on_sale and show_discount_percentage
    assign discount = product.compare_at_price | minus: product.price
    assign discount_percentage = discount | times: 100.0 | divided_by: product.compare_at_price | round
  endif

  assign has_secondary_image = false
  if show_secondary_image and product.images.size > 1
    assign has_secondary_image = true
  endif

  assign first_available_variant = product.selected_or_first_available_variant

  assign qualifies_free_shipping = false
  assign free_shipping_cents = free_shipping_threshold | times: 100
  if product.price >= free_shipping_cents
    assign qualifies_free_shipping = true
  endif
%}

<article
  class='product-card product-card--b2b {{ card_class }}{% if has_secondary_image %} product-card--has-secondary{% endif %}'
  data-product-id='{{ product.id }}'
>
  <!-- Product Image -->
  <div class='product-card__image'>
    <a href='{{ product.url }}'>
      {% if product.featured_image %}
        <img
          class='product-card__image-primary'
          src='{{ product.featured_image | image_url: width: 600 }}'
          alt='{{ product.featured_image.alt | default: product.title }}'
          {% if lazy_load %}
            loading='lazy'
          {% else %}
            loading='eager'
          {% endif %}
          width='600'
          height='600'
        >
        {% if has_secondary_image %}
          <img
            class='product-card__image-secondary'
            src='{{ product.images[1] | image_url: width: 600 }}'
            alt='{{ product.images[1].alt | default: product.title }}'
            loading='lazy'
            width='600'
            height='600'
          >
        {% endif %}
      {% else %}
        <img
          src='https://placehold.co/600x600/f1f5f9/64748b?text={{ product.title | slice: 0 }}'
          alt='{{ product.title }}'
          loading='lazy'
          width='600'
          height='600'
        >
      {% endif %}
    </a>

    <!-- Badges -->
    <div class='product-card__badges'>
      {% if sold_out %}
        <span class='product-card__badge product-card__badge--sold-out'>Sold Out</span>
      {% elsif on_sale and discount_percentage > 0 %}
        <span class='product-card__badge product-card__badge--sale'>
          {{- discount_percentage }}% OFF</span
        >
      {% elsif on_sale %}
        <span class='product-card__badge product-card__badge--sale'>Sale</span>
      {% endif %}

      {% if custom_badge %}
        <span class='product-card__badge' style='background: {{ custom_badge_color }};'>
          {{- custom_badge -}}
        </span>
      {% endif %}

      {% if product.tags contains 'bestseller' %}
        <span class='product-card__badge product-card__badge--bestseller'>Bestseller</span>
      {% endif %}

      {% if show_free_shipping and qualifies_free_shipping %}
        <span class='product-card__badge product-card__badge--shipping'>Free Shipping</span>
      {% endif %}
    </div>
  </div>

  <!-- Product Info -->
  <div class='product-card__info'>
    <!-- Supplier Info -->
    {% if show_supplier and supplier_name %}
      <div class='product-card__supplier'>
        <span class='product-card__supplier-name'>{{ supplier_name }}</span>
        {% if supplier_location %}
          <span class='product-card__supplier-location'>
            <svg
              width='12'
              height='12'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
            >
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            {{ supplier_location }}
          </span>
        {% endif %}
      </div>
    {% endif %}

    <h3 class='product-card__title'>
      <a href='{{ product.url }}'>{{ product.title }}</a>
    </h3>

    <!-- Rating -->
    {% if show_rating %}
      <div class='product-card__rating'>
        <div class='product-card__stars'>
          {% assign rating = product.metafields.reviews.rating.value | default: 4.5 %}
          {% for i in (1..5) %}
            {% if i <= rating %}
              <svg width='14' height='14' viewBox='0 0 24 24' fill='currentColor'>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
            {% else %}
              <svg
                width='14'
                height='14'
                viewBox='0 0 24 24'
                fill='none'
                stroke='currentColor'
                stroke-width='2'
              >
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
            {% endif %}
          {% endfor %}
        </div>
        <span class='product-card__rating-count'>
          ({{ product.metafields.reviews.count.value | default: '50+' }})
        </span>
      </div>
    {% endif %}

    <!-- Price -->
    <div class='product-card__price{% if on_sale %} product-card__price--on-sale{% endif %}'>
      <span class='product-card__price-current'>{{ product.price | money }}</span>
      {% if on_sale %}
        <span class='product-card__price-compare'>{{ product.compare_at_price | money }}</span>
      {% endif %}
    </div>

    <!-- Bulk Pricing -->
    {% if show_bulk_pricing %}
      <div class='product-card__bulk-pricing'>
        <svg
          width='14'
          height='14'
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          stroke-width='2'
        >
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
          <line x1="7" y1="7" x2="7.01" y2="7"></line>
        </svg>
        <span>Buy {{ bulk_threshold }}+ save {{ bulk_discount }}%</span>
      </div>
    {% endif %}

    <!-- Min Order & Supplier -->
    <div class='product-card__b2b-info'>
      {% if min_order_qty > 1 %}
        <span class='product-card__min-order'>Min. Order: {{ min_order_qty }}</span>
      {% endif %}
    </div>
  </div>

  <!-- Quick Add Button -->
  {% if show_quick_add %}
    {% unless sold_out %}
      <div class='product-card__actions'>
        <button
          type='button'
          class='product-card__quick-add'
          data-product-id='{{ product.id }}'
          data-variant-id='{{ first_available_variant.id }}'
          data-product-url='{{ product.url }}'
          aria-label='Add {{ product.title }} to cart'
        >
          <span class='product-card__quick-add-text'>Add to Cart</span>
          <span class='product-card__quick-add-loading' aria-hidden='true'>
            <svg
              class='product-card__spinner'
              width='20'
              height='20'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
            >
              <circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="32"></circle>
            </svg>
          </span>
          <span class='product-card__quick-add-success' aria-hidden='true'>
            <svg
              width='20'
              height='20'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
            >
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Added!
          </span>
        </button>
      </div>
    {% else %}
      <div class='product-card__actions'>
        <button
          type='button'
          class='product-card__quick-add product-card__quick-add--sold-out'
          disabled
        >
          Sold Out
        </button>
      </div>
    {% endunless %}
  {% endif %}
</article>
