{% comment %}
  Flash Deals Section
  Displays limited-time deals with countdown using shared product-card component
{% endcomment %}

{% if section.settings.show_section %}
  <section class='flash-deals' id='flash-deals-{{ section.id }}'>
    <div class='product-section-uniform__container'>
      <div class='flash-deals__header'>
        <div class='flash-deals__header-left'>
          <svg
            class='flash-deals__icon'
            width='24'
            height='24'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='2'
          >
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <div>
            {% if section.settings.heading != blank %}
              <h3 class='product-section-uniform__heading'>{{ section.settings.heading }}</h3>
            {% endif %}
            {% if section.settings.subheading != blank %}
              <p class='flash-deals__subheading'>{{ section.settings.subheading }}</p>
            {% endif %}
          </div>
        </div>

        {% if section.settings.show_countdown %}
          <div
            class='flash-deals__countdown'
            data-end-time='{{ section.settings.countdown_end_time }}'
          >
            <svg
              class='flash-deals__countdown-icon'
              width='20'
              height='20'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
            >
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <div class='flash-deals__countdown-time'>
              <div class='flash-deals__countdown-unit'>
                <div class='flash-deals__countdown-value' data-unit='hours'>12</div>
                <div class='flash-deals__countdown-label'>Hours</div>
              </div>
              <span class='flash-deals__countdown-separator'>:</span>
              <div class='flash-deals__countdown-unit'>
                <div class='flash-deals__countdown-value' data-unit='minutes'>33</div>
                <div class='flash-deals__countdown-label'>Min</div>
              </div>
              <span class='flash-deals__countdown-separator'>:</span>
              <div class='flash-deals__countdown-unit'>
                <div class='flash-deals__countdown-value' data-unit='seconds'>50</div>
                <div class='flash-deals__countdown-label'>Sec</div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>

      <div class='product-grid-uniform'>
        {% for block in section.blocks %}
          {% if block.type == 'product' %}
            {% if block.settings.product != blank %}
              {% assign product = all_products[block.settings.product] %}
              {% render 'product-card',
                product: product,
                show_vendor: false,
                custom_badge: block.settings.discount_text,
                custom_badge_color: '#dc2626'
              %}
            {% else %}
              {%- comment -%} Placeholder card using product-card snippet {%- endcomment -%}
              {% render 'product-card',
                placeholder: true,
                placeholder_title: block.settings.title,
                placeholder_price: block.settings.sale_price,
                custom_badge: block.settings.discount_text,
                custom_badge_color: '#dc2626'
              %}
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

<style>
  #flash-deals-{{ section.id }} {
    padding: 4rem 1.5rem;
    background: linear-gradient(to right, #fff7ed, #fef2f2);
    border-top: 1px solid rgba(251, 146, 60, 0.5);
    border-bottom: 1px solid rgba(251, 146, 60, 0.5);
  }

  #flash-deals-{{ section.id }} .flash-deals__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    gap: 1rem;
    flex-wrap: wrap;
  }

  #flash-deals-{{ section.id }} .flash-deals__header-left {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  #flash-deals-{{ section.id }} .flash-deals__icon {
    color: #ea580c;
    flex-shrink: 0;
  }

  #flash-deals-{{ section.id }} .flash-deals__subheading {
    margin: 0;
    font-size: 1rem;
    color: #64748b;
    line-height: 1.5;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #ffffff;
    border-radius: 0.75rem;
    padding: 0.75rem 1.5rem;
    border: 1px solid #fed7aa;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-icon {
    color: #ea580c;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-time {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: #0f172a;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-unit {
    text-align: center;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-value {
    font-size: 1.5rem;
    font-weight: 600;
    line-height: 1;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-label {
    font-size: 0.75rem;
    color: #64748b;
    line-height: 1;
    margin-top: 0.25rem;
  }

  #flash-deals-{{ section.id }} .flash-deals__countdown-separator {
    font-size: 1.25rem;
    font-weight: 600;
  }

  @media (max-width: 767px) {
    #flash-deals-{{ section.id }} {
      padding: 3rem 1rem;
    }

    #flash-deals-{{ section.id }} .flash-deals__header {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<script>
  (function () {
    const section = document.getElementById('flash-deals-{{ section.id }}');
    if (!section) return;

    const countdown = section.querySelector('.flash-deals__countdown');
    if (!countdown) return;

    const hours = countdown.querySelector('[data-unit="hours"]');
    const minutes = countdown.querySelector('[data-unit="minutes"]');
    const seconds = countdown.querySelector('[data-unit="seconds"]');

    function updateCountdown() {
      let h = parseInt(hours.textContent);
      let m = parseInt(minutes.textContent);
      let s = parseInt(seconds.textContent);

      s--;
      if (s < 0) {
        s = 59;
        m--;
        if (m < 0) {
          m = 59;
          h--;
          if (h < 0) {
            h = 0;
            m = 0;
            s = 0;
          }
        }
      }

      hours.textContent = String(h).padStart(2, '0');
      minutes.textContent = String(m).padStart(2, '0');
      seconds.textContent = String(s).padStart(2, '0');
    }

    setInterval(updateCountdown, 1000);
  })();
</script>

{% schema %}
{
  "name": "Flash Deals",
  "max_blocks": 8,
  "blocks": [
    {
      "type": "product",
      "name": "Deal Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product",
          "info": "Select a product or fill in manual details below"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Product Title (if no product selected)",
          "default": "Deal Product"
        },
        {
          "type": "text",
          "id": "discount_text",
          "label": "Discount Badge",
          "default": "50% OFF"
        },
        {
          "type": "text",
          "id": "sale_price",
          "label": "Sale Price",
          "default": "$79.99",
          "info": "Used if product not selected"
        },
        {
          "type": "text",
          "id": "original_price",
          "label": "Original Price",
          "default": "$159.99",
          "info": "Used if product not selected"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "checkbox",
      "id": "show_section",
      "label": "Show section",
      "default": false,
      "info": "Toggle to show/hide this section"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Limited-Time Flash Deals"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Hurry! Deals end soon"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "Show Countdown Timer",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Flash Deals",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "title": "Deal Product 1",
            "discount_text": "50% OFF",
            "sale_price": "$79.99",
            "original_price": "$159.99"
          }
        },
        {
          "type": "product",
          "settings": {
            "title": "Deal Product 2",
            "discount_text": "40% OFF",
            "sale_price": "$179.99",
            "original_price": "$299.99"
          }
        }
      ]
    }
  ]
}
{% endschema %}
