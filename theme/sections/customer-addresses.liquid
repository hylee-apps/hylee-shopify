{% comment %}
  Customer Addresses Section
{% endcomment %}

{{ 'section-customer-account.css' | asset_url | stylesheet_tag }}

<div class="customer-account min-h-screen bg-gradient-to-b from-slate-50 to-white">
  {%- comment %-%} Header {%- endcomment -%}
  <header class="customer-account__header">
    <div class="customer-account__header-inner">
      <a href="{{ routes.root_url }}" class="customer-account__logo">
        <img 
          src="https://placehold.co/28x28/71717a/ffffff?text=H" 
          alt="{{ shop.name }}"
          class="customer-account__logo-img"
          width="28"
          height="28"
        >
        <span class="customer-account__logo-text">Hylee</span>
      </a>
      <nav class="customer-account__nav">
        <a href="{{ routes.root_url }}" class="customer-account__nav-link">Home</a>
        <a href="{{ routes.all_products_collection_url }}" class="customer-account__nav-link">Products</a>
        <a href="/collections" class="customer-account__nav-link">Categories</a>
      </nav>
      <div class="customer-account__header-actions">
        <a href="{{ routes.account_logout_url }}" class="customer-account__signout-btn">
          Sign Out
        </a>
      </div>
    </div>
  </header>

  <div class="customer-account__container">
    <div class="customer-account__breadcrumb">
      <a href="{{ routes.account_url }}" class="customer-account__breadcrumb-link">Account</a>
      <span class="customer-account__breadcrumb-separator">/</span>
      <span class="customer-account__breadcrumb-current">Addresses</span>
    </div>

    <div class="customer-account__content" style="max-width: 1200px; margin: 0 auto;">
      <div class="customer-account__section-header">
        <h1 class="customer-account__title">
          {% if request.path contains '/new' %}
            Add New Address
          {% elsif request.path contains '/edit' %}
            Edit Address
          {% else %}
            Your Addresses
          {% endif %}
        </h1>
        {% unless request.path contains '/new' or request.path contains '/edit' %}
          <a href="{{ routes.account_addresses_url }}/new" class="customer-account__add-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Add New Address
          </a>
        {% endunless %}
      </div>

      {% if request.path contains '/new' or request.path contains '/edit' %}
        {%- comment %-%} Address Form {%- endcomment -%}
        {% if request.path contains '/edit' %}
          {% assign address_id = request.path | split: '/' | last | split: '/edit' | first %}
          {% assign current_address = customer.addresses | where: "id", address_id | first %}
        {% endif %}

        {% form 'customer_address', current_address %}
          <div class="customer-account__form-grid">
            <div class="customer-account__form-field">
              <label for="AddressFirstName" class="customer-account__form-label">First Name</label>
              <input
                type="text"
                name="address[first_name]"
                id="AddressFirstName"
                value="{{ current_address.first_name }}"
                class="customer-account__form-input"
                required
              >
            </div>

            <div class="customer-account__form-field">
              <label for="AddressLastName" class="customer-account__form-label">Last Name</label>
              <input
                type="text"
                name="address[last_name]"
                id="AddressLastName"
                value="{{ current_address.last_name }}"
                class="customer-account__form-input"
                required
              >
            </div>
          </div>

          <div class="customer-account__form-field">
            <label for="AddressCompany" class="customer-account__form-label">Company (Optional)</label>
            <input
              type="text"
              name="address[company]"
              id="AddressCompany"
              value="{{ current_address.company }}"
              class="customer-account__form-input"
            >
          </div>

          <div class="customer-account__form-field">
            <label for="AddressAddress1" class="customer-account__form-label">Address</label>
            <input
              type="text"
              name="address[address1]"
              id="AddressAddress1"
              value="{{ current_address.address1 }}"
              class="customer-account__form-input"
              required
            >
          </div>

          <div class="customer-account__form-field">
            <label for="AddressAddress2" class="customer-account__form-label">Apartment, suite, etc. (Optional)</label>
            <input
              type="text"
              name="address[address2]"
              id="AddressAddress2"
              value="{{ current_address.address2 }}"
              class="customer-account__form-input"
            >
          </div>

          <div class="customer-account__form-grid">
            <div class="customer-account__form-field">
              <label for="AddressCity" class="customer-account__form-label">City</label>
              <input
                type="text"
                name="address[city]"
                id="AddressCity"
                value="{{ current_address.city }}"
                class="customer-account__form-input"
                required
              >
            </div>

            <div class="customer-account__form-field">
              <label for="AddressCountry" class="customer-account__form-label">Country</label>
              <select
                name="address[country]"
                id="AddressCountry"
                class="customer-account__form-input"
                required
              >
                {{ current_address.country | default: 'United States' | country_option_tags }}
              </select>
            </div>
          </div>

          <div class="customer-account__form-grid">
            <div class="customer-account__form-field">
              <label for="AddressProvince" class="customer-account__form-label">State/Province</label>
              <input
                type="text"
                name="address[province]"
                id="AddressProvince"
                value="{{ current_address.province }}"
                class="customer-account__form-input"
                required
              >
            </div>

            <div class="customer-account__form-field">
              <label for="AddressZip" class="customer-account__form-label">ZIP/Postal Code</label>
              <input
                type="text"
                name="address[zip]"
                id="AddressZip"
                value="{{ current_address.zip }}"
                class="customer-account__form-input"
                required
              >
            </div>
          </div>

          <div class="customer-account__form-field">
            <label for="AddressPhone" class="customer-account__form-label">Phone (Optional)</label>
            <input
              type="tel"
              name="address[phone]"
              id="AddressPhone"
              value="{{ current_address.phone }}"
              class="customer-account__form-input"
            >
          </div>

          <div class="customer-account__form-field">
            <label class="customer-account__checkbox-wrapper">
              <input
                type="checkbox"
                name="address[default]"
                id="AddressDefault"
                {% if current_address.default %}checked{% endif %}
                class="customer-account__checkbox"
              >
              <span class="customer-account__checkbox-label">Set as default address</span>
            </label>
          </div>

          <div class="customer-account__form-actions">
            <button type="submit" class="customer-account__form-btn customer-account__form-btn--save">
              {% if request.path contains '/new' %}Add Address{% else %}Save Address{% endif %}
            </button>
            <a href="{{ routes.account_url }}" class="customer-account__form-btn customer-account__form-btn--cancel">Cancel</a>
          </div>
        {% endform %}

        {% if request.path contains '/edit' %}
          <div class="customer-account__form-delete">
            {% form 'customer_address', current_address, method: 'delete' %}
              <button type="submit" class="customer-account__delete-btn" onclick="return confirm('Are you sure you want to delete this address?');">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Delete Address
              </button>
            {% endform %}
          </div>
        {% endif %}

      {% else %}
        {%- comment %-%} Address List {%- endcomment -%}
        <div class="customer-account__addresses-list">
          {% if customer.addresses.size > 0 %}
            {% for address in customer.addresses %}
              <div class="customer-account__address-card" id="address-card-{{ address.id }}">
                {% if address.default %}
                  <span class="customer-account__address-badge">Default</span>
                {% endif %}
                
                {%- comment %-%} Address Display {%- endcomment -%}
                <div class="customer-account__address-display" id="address-display-{{ address.id }}">
                  <div class="customer-account__address-content">
                    <div class="customer-account__address-header">
                      <svg class="customer-account__address-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2AC864">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                      <span class="customer-account__address-type">
                        {% if address.company %}{{ address.company }}{% else %}Address{% endif %}
                      </span>
                    </div>
                    <p class="customer-account__address-name">{{ address.name }}</p>
                    <p class="customer-account__address-line">{{ address.address1 }}</p>
                    {% if address.address2 != blank %}
                      <p class="customer-account__address-line">{{ address.address2 }}</p>
                    {% endif %}
                    <p class="customer-account__address-line">
                      {{ address.city }}, {{ address.province_code }} {{ address.zip }}
                    </p>
                    {% if address.phone != blank %}
                      <p class="customer-account__address-line">{{ address.phone }}</p>
                    {% endif %}
                  </div>
                  <div class="customer-account__address-actions">
                    <button type="button" class="customer-account__address-btn" onclick="toggleAddressForm({{ address.id }})">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                      </svg>
                      Edit
                    </button>
                    <button type="button" class="customer-account__address-btn customer-account__address-btn--delete" onclick="confirmDeleteAddress({{ address.id }})">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                      Delete
                    </button>
                  </div>
                </div>

                {%- comment %-%} Edit Form {%- endcomment -%}
                <div class="customer-account__address-edit-form" id="address-edit-{{ address.id }}" style="display: none;">
                  {% form 'customer_address', address, data-shopify-captcha: 'true' %}
                    <input type="hidden" name="return_to" value="/account/addresses">
                    <div class="customer-account__form-grid">
                      <div class="customer-account__form-field">
                        <label for="AddressFirstName{{ address.id }}" class="customer-account__form-label">First Name</label>
                        <input type="text" name="address[first_name]" id="AddressFirstName{{ address.id }}" class="customer-account__form-input" value="{{ address.first_name }}" required>
                      </div>
                      <div class="customer-account__form-field">
                        <label for="AddressLastName{{ address.id }}" class="customer-account__form-label">Last Name</label>
                        <input type="text" name="address[last_name]" id="AddressLastName{{ address.id }}" class="customer-account__form-input" value="{{ address.last_name }}" required>
                      </div>
                    </div>
                    <div class="customer-account__form-field">
                      <label for="AddressCompany{{ address.id }}" class="customer-account__form-label">Company (Optional)</label>
                      <input type="text" name="address[company]" id="AddressCompany{{ address.id }}" class="customer-account__form-input" value="{{ address.company }}">
                    </div>
                    <div class="customer-account__form-field">
                      <label for="AddressAddress1{{ address.id }}" class="customer-account__form-label">Address Line 1</label>
                      <input type="text" name="address[address1]" id="AddressAddress1{{ address.id }}" class="customer-account__form-input" value="{{ address.address1 }}" required>
                    </div>
                    <div class="customer-account__form-field">
                      <label for="AddressAddress2{{ address.id }}" class="customer-account__form-label">Address Line 2 (Optional)</label>
                      <input type="text" name="address[address2]" id="AddressAddress2{{ address.id }}" class="customer-account__form-input" value="{{ address.address2 }}">
                    </div>
                    <div class="customer-account__form-grid">
                      <div class="customer-account__form-field">
                        <label for="AddressCity{{ address.id }}" class="customer-account__form-label">City</label>
                        <input type="text" name="address[city]" id="AddressCity{{ address.id }}" class="customer-account__form-input" value="{{ address.city }}" required>
                      </div>
                      <div class="customer-account__form-field">
                        <label for="AddressCountry{{ address.id }}" class="customer-account__form-label">Country</label>
                        <select name="address[country]" id="AddressCountry{{ address.id }}" class="customer-account__form-input" data-default="{{ address.country }}" required>
                          {{ country_option_tags }}
                        </select>
                      </div>
                    </div>
                    <div class="customer-account__form-grid">
                      <div class="customer-account__form-field">
                        <label for="AddressProvince{{ address.id }}" class="customer-account__form-label">State/Province</label>
                        <select name="address[province]" id="AddressProvince{{ address.id }}" class="customer-account__form-input" data-default="{{ address.province }}">
                          <option value="">Select State/Province</option>
                        </select>
                      </div>
                      <div class="customer-account__form-field">
                        <label for="AddressZip{{ address.id }}" class="customer-account__form-label">ZIP/Postal Code</label>
                        <input type="text" name="address[zip]" id="AddressZip{{ address.id }}" class="customer-account__form-input" value="{{ address.zip }}" required>
                      </div>
                    </div>
                    <div class="customer-account__form-field">
                      <label for="AddressPhone{{ address.id }}" class="customer-account__form-label">Phone (Optional)</label>
                      <input type="tel" name="address[phone]" id="AddressPhone{{ address.id }}" class="customer-account__form-input" value="{{ address.phone }}">
                    </div>
                    {% if address != customer.default_address %}
                      <div class="customer-account__form-checkbox">
                        <input type="checkbox" name="address[default]" id="AddressDefault{{ address.id }}" value="1">
                        <label for="AddressDefault{{ address.id }}">Set as default address</label>
                      </div>
                    {% endif %}
                    <div class="customer-account__form-actions">
                      <button type="submit" class="customer-account__save-btn">Save Changes</button>
                      <button type="button" class="customer-account__cancel-btn" onclick="toggleAddressForm({{ address.id }})">Cancel</button>
                    </div>
                  {% endform %}
                </div>

                {%- comment %-%} Hidden Delete Form {%- endcomment -%}
                <div style="display: none;">
                  <form method="post" action="{{ routes.account_addresses_url }}/{{ address.id }}">
                    <input type="hidden" name="_method" value="delete">
                    <button type="submit" id="delete-address-{{ address.id }}"></button>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="customer-account__empty-state">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <p>No addresses saved yet</p>
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>

  {%- comment %-%} Footer {%- endcomment -%}
  <footer class="customer-account__footer">
    <div class="customer-account__footer-inner">
      <p class="customer-account__footer-copyright">
        Â© {{ 'now' | date: '%Y' }} {{ shop.name }}. All rights reserved.
      </p>
      <div class="customer-account__footer-links">
        <a href="/pages/privacy" class="customer-account__footer-link">Privacy Policy</a>
        <a href="/pages/terms" class="customer-account__footer-link">Terms of Service</a>
        <a href="/pages/contact" class="customer-account__footer-link">Contact Support</a>
      </div>
    </div>
  </footer>
</div>

<script>
  // Address form toggle
  window.toggleAddressForm = function(addressId) {
    const editForm = document.getElementById(`address-edit-${addressId}`);
    const display = document.getElementById(`address-display-${addressId}`);
    const isHidden = editForm.style.display === 'none';
    
    // Hide all other edit forms
    document.querySelectorAll('.customer-account__address-edit-form').forEach(form => {
      if (form.id !== `address-edit-${addressId}`) {
        form.style.display = 'none';
      }
    });
    document.querySelectorAll('.customer-account__address-display').forEach(disp => {
      if (disp.id !== `address-display-${addressId}`) {
        disp.style.display = 'block';
      }
    });
    
    // Toggle this address's edit form
    editForm.style.display = isHidden ? 'block' : 'none';
    display.style.display = isHidden ? 'none' : 'block';
    
    if (isHidden) {
      editForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  };

  // Confirm delete address
  window.confirmDeleteAddress = function(addressId) {
    if (confirm('Are you sure you want to delete this address?')) {
      const deleteBtn = document.getElementById(`delete-address-${addressId}`);
      if (deleteBtn) {
        deleteBtn.click();
      }
    }
  };

  // Province/State handling for address forms
  window.Shopify = window.Shopify || {};
  window.Shopify.CountryProvinceSelector = function(countryElementId, provinceElementId, options) {
    this.countryEl = document.getElementById(countryElementId);
    this.provinceEl = document.getElementById(provinceElementId);
    this.provinceContainer = document.getElementById(options.provinceContainer) || this.provinceEl.parentElement;
    
    this.countryEl.addEventListener('change', () => {
      this.onCountryChange();
    });
    
    this.initCountry();
    this.initProvince();
  };
  
  window.Shopify.CountryProvinceSelector.prototype = {
    initCountry: function() {
      const value = this.countryEl.getAttribute('data-default');
      this.countryEl.value = value || '';
      this.onCountryChange();
    },
    
    initProvince: function() {
      const value = this.provinceEl.getAttribute('data-default');
      if (value && this.provinceEl.options.length > 0) {
        this.provinceEl.value = value;
      }
    },
    
    onCountryChange: function() {
      this.updateProvince();
    },
    
    updateProvince: function() {
      const provinces = this.getProvinces();
      this.clearOptions(this.provinceEl);
      
      if (provinces && provinces.length > 0) {
        this.provinceEl.disabled = false;
        this.provinceEl.parentElement.style.display = '';
        
        this.provinceEl.options.add(new Option('Select State/Province', ''));
        
        for (let i = 0; i < provinces.length; i++) {
          const opt = new Option(provinces[i][0], provinces[i][1]);
          this.provinceEl.options.add(opt);
        }
        
        const defaultValue = this.provinceEl.getAttribute('data-default');
        if (defaultValue) {
          this.provinceEl.value = defaultValue;
        }
      } else {
        this.provinceEl.disabled = true;
        this.provinceEl.parentElement.style.display = 'none';
      }
    },
    
    clearOptions: function(selector) {
      while (selector.firstChild) {
        selector.removeChild(selector.firstChild);
      }
    },
    
    getProvinces: function() {
      const countryCode = this.countryEl.value;
      return window.Shopify.CountryProvinces[countryCode] || [];
    }
  };
  
  // Country/Province data
  window.Shopify.CountryProvinces = {
    "US": [
      ["Alabama", "AL"], ["Alaska", "AK"], ["Arizona", "AZ"], ["Arkansas", "AR"],
      ["California", "CA"], ["Colorado", "CO"], ["Connecticut", "CT"], ["Delaware", "DE"],
      ["Florida", "FL"], ["Georgia", "GA"], ["Hawaii", "HI"], ["Idaho", "ID"],
      ["Illinois", "IL"], ["Indiana", "IN"], ["Iowa", "IA"], ["Kansas", "KS"],
      ["Kentucky", "KY"], ["Louisiana", "LA"], ["Maine", "ME"], ["Maryland", "MD"],
      ["Massachusetts", "MA"], ["Michigan", "MI"], ["Minnesota", "MN"], ["Mississippi", "MS"],
      ["Missouri", "MO"], ["Montana", "MT"], ["Nebraska", "NE"], ["Nevada", "NV"],
      ["New Hampshire", "NH"], ["New Jersey", "NJ"], ["New Mexico", "NM"], ["New York", "NY"],
      ["North Carolina", "NC"], ["North Dakota", "ND"], ["Ohio", "OH"], ["Oklahoma", "OK"],
      ["Oregon", "OR"], ["Pennsylvania", "PA"], ["Rhode Island", "RI"], ["South Carolina", "SC"],
      ["South Dakota", "SD"], ["Tennessee", "TN"], ["Texas", "TX"], ["Utah", "UT"],
      ["Vermont", "VT"], ["Virginia", "VA"], ["Washington", "WA"], ["West Virginia", "WV"],
      ["Wisconsin", "WI"], ["Wyoming", "WY"]
    ],
    "United States": [
      ["Alabama", "AL"], ["Alaska", "AK"], ["Arizona", "AZ"], ["Arkansas", "AR"],
      ["California", "CA"], ["Colorado", "CO"], ["Connecticut", "CT"], ["Delaware", "DE"],
      ["Florida", "FL"], ["Georgia", "GA"], ["Hawaii", "HI"], ["Idaho", "ID"],
      ["Illinois", "IL"], ["Indiana", "IN"], ["Iowa", "IA"], ["Kansas", "KS"],
      ["Kentucky", "KY"], ["Louisiana", "LA"], ["Maine", "ME"], ["Maryland", "MD"],
      ["Massachusetts", "MA"], ["Michigan", "MI"], ["Minnesota", "MN"], ["Mississippi", "MS"],
      ["Missouri", "MO"], ["Montana", "MT"], ["Nebraska", "NE"], ["Nevada", "NV"],
      ["New Hampshire", "NH"], ["New Jersey", "NJ"], ["New Mexico", "NM"], ["New York", "NY"],
      ["North Carolina", "NC"], ["North Dakota", "ND"], ["Ohio", "OH"], ["Oklahoma", "OK"],
      ["Oregon", "OR"], ["Pennsylvania", "PA"], ["Rhode Island", "RI"], ["South Carolina", "SC"],
      ["South Dakota", "SD"], ["Tennessee", "TN"], ["Texas", "TX"], ["Utah", "UT"],
      ["Vermont", "VT"], ["Virginia", "VA"], ["Washington", "WA"], ["West Virginia", "WV"],
      ["Wisconsin", "WI"], ["Wyoming", "WY"]
    ],
    "CA": [
      ["Alberta", "AB"], ["British Columbia", "BC"], ["Manitoba", "MB"], ["New Brunswick", "NB"],
      ["Newfoundland and Labrador", "NL"], ["Northwest Territories", "NT"], ["Nova Scotia", "NS"],
      ["Nunavut", "NU"], ["Ontario", "ON"], ["Prince Edward Island", "PE"], ["Quebec", "QC"],
      ["Saskatchewan", "SK"], ["Yukon", "YT"]
    ],
    "Canada": [
      ["Alberta", "AB"], ["British Columbia", "BC"], ["Manitoba", "MB"], ["New Brunswick", "NB"],
      ["Newfoundland and Labrador", "NL"], ["Northwest Territories", "NT"], ["Nova Scotia", "NS"],
      ["Nunavut", "NU"], ["Ontario", "ON"], ["Prince Edward Island", "PE"], ["Quebec", "QC"],
      ["Saskatchewan", "SK"], ["Yukon", "YT"]
    ]
  };
  
  // Initialize selectors on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Edit address forms
    const addressForms = document.querySelectorAll('[id^="AddressCountry"]');
    addressForms.forEach(function(countrySelect) {
      const addressId = countrySelect.id.replace('AddressCountry', '');
      if (addressId) {
        const provinceSelect = document.getElementById('AddressProvince' + addressId);
        if (provinceSelect) {
          new window.Shopify.CountryProvinceSelector('AddressCountry' + addressId, 'AddressProvince' + addressId, {
            provinceContainer: 'AddressProvince' + addressId
          });
        }
      }
    });
  });
</script>

{% schema %}
{
  "name": "Customer Addresses",
  "settings": []
}
{% endschema %}
