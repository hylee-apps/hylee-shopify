{
  "id": "51a99f0b-8abf-47d5-8a8a-1f9d2d334598",
  "name": "CI/CD Pipeline",
  "description": "GitHub Actions workflows",
  "category": "deployment",
  "tags": [
    {
      "name": "deployment",
      "category": "custom"
    }
  ],
  "problem": {
    "keywords": [
      "deployment",
      "integration",
      "pipeline"
    ],
    "description": "Solution for: GitHub Actions workflows",
    "errorPatterns": []
  },
  "implementation": {
    "files": [
      {
        "path": "AccountManagementPage.tsx",
        "purpose": "UI component: AccountManagementPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { FormInput } from '@/components/ui/forms';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport {\n  User,\n  Mail,\n  Shield,\n  Save,\n  Loader2,\n  CheckCircle,\n  ArrowLeft,\n  LogOut,\n  Key,\n  UserCircle,\n  Lock,\n  Clock,\n  Users,\n  CheckCircle2,\n  XCircle,\n  AlertCircle,\n  Settings,\n  Activity,\n  Bell,\n  Eye,\n  Database,\n} from 'lucide-react';\n\ninterface AccountManagementPageProps {\n  onBack: () => void;\n}\n\n// Define permission groups\nconst permissionGroups = [\n  {\n    category: 'Workspace Management',\n    permissions: [\n      {\n        id: 'create_workspace',\n        name: 'Create Workspaces',\n        description: 'Create new workspaces',\n      },\n      {\n        id: 'edit_workspace',\n        name: 'Edit Workspaces',\n        description: 'Modify workspace settings',\n      },\n      {\n        id: 'delete_workspace',\n        name: 'Delete Workspaces',\n        description: 'Remove workspaces',\n      },\n    ],\n  },\n  {\n    category: 'Board Management',\n    permissions: [\n      {\n        id: 'create_board',\n        name: 'Create Boards',\n        description: 'Create new boards',\n      },\n      {\n        id: 'edit_board',\n        name: 'Edit Boards',\n        description: 'Modify board settings',\n      },\n      {\n        id: 'delete_board',\n        name: 'Delete Boards',\n        description: 'Remove boards',\n      },\n    ],\n  },\n  {\n    category: 'Task Management',\n    permissions: [\n      {\n        id: 'create_task',\n        name: 'Create Tasks',\n        description: 'Create new tasks',\n      },\n      {\n        id: 'edit_task',\n        name: 'Edit Tasks',\n        description: 'Modify task details',\n      },\n      { id: 'delete_task', name: 'Delete Tasks', description: 'Remove tasks' },\n      {\n        id: 'assign_task',\n        name: 'Assign Tasks',\n        description: 'Assign tasks to users',\n      },\n    ],\n  },\n  {\n    category: 'User Management',\n    permissions: [\n      {\n        id: 'invite_user',\n        name: 'Invite Users',\n        description: 'Invite new team members',\n      },\n      {\n        id: 'manage_roles',\n        name: 'Manage Roles',\n        description: 'Assign roles to users',\n      },\n      {\n        id: 'remove_user',\n        name: 'Remove Users',\n        description: 'Remove team members',\n      },\n    ],\n  },\n];\n\n// Role definitions with permissions\nconst rolePermissions: Record<string, string[]> = {\n  admin: [\n    'create_workspace',\n    'edit_workspace',\n    'delete_workspace',\n    'create_board',\n    'edit_board',\n    'delete_board',\n    'create_task',\n    'edit_task',\n    'delete_task',\n    'assign_task',\n    'invite_user',\n    'manage_roles',\n    'remove_user',\n  ],\n  manager: [\n    'create_board',\n    'edit_board',\n    'create_task',\n    'edit_task',\n    'delete_task',\n    'assign_task',\n    'invite_user',\n  ],\n  member: ['create_task', 'edit_task', 'assign_task'],\n  viewer: [],\n};\n\nexport function AccountManagementPage({ onBack }: AccountManagementPageProps) {\n  const { user, updateProfile, signOut } = useAuth();\n  const [activeTab, setActiveTab] = useState('profile');\n  const [name, setName] = useState(user?.user_metadata?.name || '');\n  const [avatarUrl, setAvatarUrl] = useState(user?.user_metadata?.avatar || '');\n  const [loading, setLoading] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [error, setError] = useState('');\n\n  const userRole = (user?.user_metadata?.role || 'member') as string;\n  const userPermissions = rolePermissions[userRole] || [];\n\n  const handleSave = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setSuccess(false);\n    setLoading(true);\n\n    const { error: updateError } = await updateProfile({\n      name: name.trim(),\n      avatar: avatarUrl.trim(),\n    });\n\n    if (updateError) {\n      setError(updateError.message || 'Failed to update profile');\n    } else {\n      setSuccess(true);\n      setTimeout(() => setSuccess(false), 3000);\n    }\n\n    setLoading(false);\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getAvatarColor = (name: string) => {\n    const colors = [\n      'bg-gradient-to-br from-blue-500 to-blue-600',\n      'bg-gradient-to-br from-purple-500 to-purple-600',\n      'bg-gradient-to-br from-pink-500 to-pink-600',\n      'bg-gradient-to-br from-indigo-500 to-indigo-600',\n      'bg-gradient-to-br from-cyan-500 to-cyan-600',\n    ];\n    const index = name.charCodeAt(0) % colors.length;\n    return colors[index];\n  };\n\n  const getRoleBadgeColor = (role: string) => {\n    const colors: Record<string, string> = {\n      admin:\n        'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border-red-200 dark:border-red-800',\n      manager:\n        'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-800',\n      member:\n        'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-800',\n      viewer:\n        'bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-800',\n    };\n    return colors[role] || colors.member;\n  };\n\n  const hasPermission = (permissionId: string) => {\n    return userPermissions.includes(permissionId);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-slate-950\">\n      {/* Header */}\n      <div className=\"border-b border-gray-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900\">\n        <div className=\"mx-auto max-w-6xl px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onBack}\n                className=\"hover:bg-gray-100 dark:hover:bg-slate-800\"\n              >\n                <ArrowLeft className=\"mr-2 size-4\" />\n                Back to App\n              </Button>\n              <div className=\"h-6 w-px bg-gray-300 dark:bg-slate-700\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-gray-900 dark:text-gray-100\">\n                  Account Management\n                </h1>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  Manage your profile, security, and permissions\n                </p>\n              </div>\n            </div>\n            <Button\n              variant=\"outline\"\n              onClick={signOut}\n              className=\"border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-900/20\"\n            >\n              <LogOut className=\"mr-2 size-4\" />\n              Sign Out\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"mx-auto max-w-6xl px-6 py-8\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-4 lg:inline-grid lg:w-auto\">\n            <TabsTrigger value=\"profile\" className=\"flex items-center gap-2\">\n              <UserCircle className=\"size-4\" />\n              Profile\n            </TabsTrigger>\n            <TabsTrigger value=\"security\" className=\"flex items-center gap-2\">\n              <Shield className=\"size-4\" />\n              Security\n            </TabsTrigger>\n            <TabsTrigger value=\"permissions\" className=\"flex items-center gap-2\">\n              <Lock className=\"size-4\" />\n              Permissions\n            </TabsTrigger>\n            <TabsTrigger value=\"activity\" className=\"flex items-center gap-2\">\n              <Activity className=\"size-4\" />\n              Activity\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Profile Tab */}\n          <TabsContent value=\"profile\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-3\">\n                  <UserCircle className=\"size-6 text-[var(--primary)]\" />\n                  Profile Information\n                </CardTitle>\n                <CardDescription>Update your personal details and avatar</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleSave} className=\"space-y-6\">\n                  {/* Avatar Preview */}\n                  <div className=\"flex items-center gap-6\">\n                    <Avatar\n                      className={`size-24 ${getAvatarColor(name || 'U')} border-4 border-white text-white shadow-lg dark:border-slate-800`}\n                    >\n                      <AvatarFallback className=\"text-2xl font-bold\">\n                        {getInitials(name || user?.email || 'U')}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                      <h3 className=\"mb-1 font-semibold text-gray-900 dark:text-gray-100\">\n                        {name || 'No name set'}\n                      </h3>\n                      <p className=\"mb-2 text-sm text-gray-600 dark:text-gray-400\">{user?.email}</p>\n                      <Badge className={`${getRoleBadgeColor(userRole)} border`}>\n                        {userRole\n                          .split('_')\n                          .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))\n                          .join(' ')}\n                      </Badge>\n                    </div>\n                  </div>\n\n                  {/* Success/Error Messages */}\n                  {success && (\n                    <div className=\"flex items-center gap-2 rounded-lg border border-green-200 bg-green-50 px-4 py-3 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-200\">\n                      <CheckCircle className=\"size-5\" />\n                      <span>Profile updated successfully!</span>\n                    </div>\n                  )}\n\n                  {error && (\n                    <div className=\"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800 dark:border-red-800 dark:bg-red-900/20 dark:text-red-200\">\n                      {error}\n                    </div>\n                  )}\n\n                  {/* Form Fields */}\n                  <div className=\"grid gap-6\">\n                    <div className=\"space-y-2\">\n                      <FormInput\n                        label=\"Full Name\"\n                        id=\"name\"\n                        type=\"text\"\n                        placeholder=\"John Doe\"\n                        value={name}\n                        onChange={(e) => setName(e.target.value)}\n                        leftIcon={<User className=\"size-5 text-gray-400 dark:text-gray-500\" />}\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <FormInput\n                        label=\"Email Address\"\n                        id=\"email\"\n                        type=\"email\"\n                        value={user?.email || ''}\n                        disabled\n                        leftIcon={<Mail className=\"size-5 text-gray-400 dark:text-gray-500\" />}\n                        description=\"Email address cannot be changed\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <FormInput\n                        label=\"Avatar URL (Optional)\"\n                        id=\"avatar\"\n                        type=\"url\"\n                        placeholder=\"https://example.com/avatar.jpg\"\n                        value={avatarUrl}\n                        onChange={(e) => setAvatarUrl(e.target.value)}\n                        description=\"Provide a URL to use as your profile picture\"\n                      />\n                    </div>\n                  </div>\n\n                  <Button\n                    type=\"submit\"\n                    disabled={loading}\n                    className=\"h-11 w-full bg-[var(--primary)] font-semibold text-white shadow-lg transition-all hover:opacity-90 hover:shadow-xl\"\n                  >\n                    {loading ? (\n                      <>\n                        <Loader2 className=\"mr-2 size-5 animate-spin\" />\n                        Saving...\n                      </>\n                    ) : (\n                      <>\n                        <Save className=\"mr-2 size-5\" />\n                        Save Changes\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Security Tab */}\n          <TabsContent value=\"security\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-3\">\n                  <Shield className=\"size-6 text-green-600 dark:text-green-400\" />\n                  Account Security\n                </CardTitle>\n                <CardDescription>Manage your account security settings</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Email Verification Status */}\n                <div className=\"flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-slate-700 dark:bg-slate-800\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"rounded-lg bg-green-100 p-2 dark:bg-green-900/30\">\n                      <CheckCircle2 className=\"size-5 text-green-600 dark:text-green-400\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n                        Email Verified\n                      </p>\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                        Your email address is confirmed\n                      </p>\n                    </div>\n                  </div>\n                  <Badge className=\"border border-green-200 bg-green-100 text-green-700 dark:border-green-800 dark:bg-green-900/30 dark:text-green-300\">\n                    Active\n                  </Badge>\n                </div>\n\n                {/* Account Details */}\n                <div className=\"grid gap-4\">\n                  <div className=\"flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-slate-700 dark:bg-slate-800\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"rounded-lg bg-[var(--primary)]/10 p-2\">\n                        <Mail className=\"size-5 text-[var(--primary)]\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n                          Email Address\n                        </p>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">{user?.email}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-slate-700 dark:bg-slate-800\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"rounded-lg bg-purple-100 p-2 dark:bg-purple-900/30\">\n                        <Key className=\"size-5 text-purple-600 dark:text-purple-400\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n                          User ID\n                        </p>\n                        <p className=\"font-mono text-xs text-gray-600 dark:text-gray-400\">\n                          {user?.id}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Security Notice */}\n                <div className=\"mt-6 rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-900/20\">\n                  <div className=\"flex gap-3\">\n                    <AlertCircle className=\"mt-0.5 size-5 flex-shrink-0 text-amber-600 dark:text-amber-400\" />\n                    <div>\n                      <h4 className=\"mb-1 text-sm font-semibold text-amber-900 dark:text-amber-200\">\n                        Security Notice\n                      </h4>\n                      <p className=\"text-sm text-amber-800 dark:text-amber-300\">\n                        This is a prototype environment. For production use, implement 2FA, password\n                        change functionality, and session management.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Permissions Tab */}\n          <TabsContent value=\"permissions\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-3\">\n                  <Lock className=\"size-6 text-indigo-600 dark:text-indigo-400\" />\n                  Role & Permissions\n                </CardTitle>\n                <CardDescription>\n                  Your role:{' '}\n                  <span className=\"font-semibold\">\n                    {userRole\n                      .split('_')\n                      .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))\n                      .join(' ')}\n                  </span>\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-6\">\n                  {/* Role Information */}\n                  <div className=\"rounded-lg border border-indigo-200 bg-gradient-to-br from-indigo-50 to-purple-50 p-5 dark:border-indigo-800 dark:from-indigo-950/30 dark:to-purple-950/30\">\n                    <div className=\"flex items-start gap-4\">\n                      <div className={`p-3 ${getRoleBadgeColor(userRole)} rounded-lg`}>\n                        <Shield className=\"size-6\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"mb-2 font-semibold text-gray-900 dark:text-gray-100\">\n                          {userRole.charAt(0).toUpperCase() + userRole.slice(1)} Role\n                        </h3>\n                        <p className=\"mb-3 text-sm text-gray-700 dark:text-gray-300\">\n                          {userRole === 'admin' &&\n                            'Full system access with all permissions enabled.'}\n                          {userRole === 'manager' && 'Manage boards, tasks, and team members.'}\n                          {userRole === 'member' && 'Create and manage your own tasks.'}\n                          {userRole === 'viewer' && 'View-only access to boards and tasks.'}\n                        </p>\n                        <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                          <CheckCircle2 className=\"size-4 text-green-600 dark:text-green-400\" />\n                          <span>{userPermissions.length} permissions granted</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Permissions List */}\n                  <div className=\"space-y-4\">\n                    {permissionGroups.map((group) => (\n                      <div\n                        key={group.category}\n                        className=\"overflow-hidden rounded-lg border border-gray-200 dark:border-slate-700\"\n                      >\n                        <div className=\"border-b border-gray-200 bg-gray-50 px-4 py-3 dark:border-slate-700 dark:bg-slate-800\">\n                          <h4 className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                            {group.category}\n                          </h4>\n                        </div>\n                        <div className=\"divide-y divide-gray-200 dark:divide-slate-700\">\n                          {group.permissions.map((permission) => {\n                            const granted = hasPermission(permission.id);\n                            return (\n                              <div\n                                key={permission.id}\n                                className=\"flex items-center justify-between p-4 transition-colors hover:bg-gray-50 dark:hover:bg-slate-800/50\"\n                              >\n                                <div className=\"flex flex-1 items-start gap-3\">\n                                  {granted ? (\n                                    <CheckCircle2 className=\"mt-0.5 size-5 flex-shrink-0 text-green-600 dark:text-green-400\" />\n                                  ) : (\n                                    <XCircle className=\"mt-0.5 size-5 flex-shrink-0 text-gray-400 dark:text-gray-600\" />\n                                  )}\n                                  <div>\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n                                      {permission.name}\n                                    </p>\n                                    <p className=\"mt-0.5 text-xs text-gray-600 dark:text-gray-400\">\n                                      {permission.description}\n                                    </p>\n                                  </div>\n                                </div>\n                                <Badge\n                                  className={\n                                    granted\n                                      ? 'border border-green-200 bg-green-100 text-green-700 dark:border-green-800 dark:bg-green-900/30 dark:text-green-300'\n                                      : 'border border-gray-200 bg-gray-100 text-gray-600 dark:border-gray-800 dark:bg-gray-900/30 dark:text-gray-400'\n                                  }\n                                >\n                                  {granted ? 'Granted' : 'Denied'}\n                                </Badge>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* Info Notice */}\n                  <div className=\"rounded-lg border border-[var(--primary)]/20 bg-[var(--primary)]/10 p-4\">\n                    <div className=\"flex gap-3\">\n                      <AlertCircle className=\"mt-0.5 size-5 flex-shrink-0 text-[var(--primary)]\" />\n                      <div>\n                        <h4 className=\"mb-1 text-sm font-semibold text-blue-900 dark:text-blue-200\">\n                          Permission Management\n                        </h4>\n                        <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n                          Contact an administrator to request role changes or additional\n                          permissions.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Activity Tab */}\n          <TabsContent value=\"activity\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-3\">\n                  <Activity className=\"size-6 text-purple-600 dark:text-purple-400\" />\n                  Account Activity\n                </CardTitle>\n                <CardDescription>Recent activity and session information</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {/* Current Session */}\n                  <div className=\"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-5 dark:border-green-800 dark:from-green-950/30 dark:to-emerald-950/30\">\n                    <div className=\"mb-3 flex items-center gap-3\">\n                      <div className=\"rounded-lg bg-green-100 p-2 dark:bg-green-900/30\">\n                        <CheckCircle2 className=\"size-5 text-green-600 dark:text-green-400\" />\n                      </div>\n                      <div>\n                        <p className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          Current Session\n                        </p>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          You are currently signed in\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-1 gap-3 text-sm md:grid-cols-2\">\n                      <div className=\"flex items-center gap-2 text-gray-700 dark:text-gray-300\">\n                        <Clock className=\"size-4\" />\n                        <span>Active now</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-gray-700 dark:text-gray-300\">\n                        <Database className=\"size-4\" />\n                        <span>LocalStorage enabled</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Activity Log Placeholder */}\n                  <div className=\"rounded-lg border border-gray-200 p-6 text-center dark:border-slate-700\">\n                    <Activity className=\"mx-auto mb-3 size-12 text-gray-400 dark:text-gray-600\" />\n                    <h3 className=\"mb-2 font-semibold text-gray-900 dark:text-gray-100\">\n                      Activity Log\n                    </h3>\n                    <p className=\"mb-4 text-sm text-gray-600 dark:text-gray-400\">\n                      Activity tracking is not yet implemented in this prototype.\n                    </p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n                      In production, this would show your recent actions, login history, and\n                      security events.\n                    </p>\n                  </div>\n\n                  {/* Info Notice */}\n                  <div className=\"rounded-lg border border-purple-200 bg-purple-50 p-4 dark:border-purple-800 dark:bg-purple-900/20\">\n                    <div className=\"flex gap-3\">\n                      <AlertCircle className=\"mt-0.5 size-5 flex-shrink-0 text-purple-600 dark:text-purple-400\" />\n                      <div>\n                        <h4 className=\"mb-1 text-sm font-semibold text-purple-900 dark:text-purple-200\">\n                          Activity Tracking\n                        </h4>\n                        <p className=\"text-sm text-purple-800 dark:text-purple-300\">\n                          For production environments, implement comprehensive audit logs including\n                          login attempts, data changes, and security events.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n",
        "exports": [
          "AccountManagementPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/forms",
          "@/components/ui/avatar",
          "@/components/ui/tabs",
          "@/components/ui/badge",
          "@/components/ui/card",
          "lucide-react"
        ],
        "lineCount": 673
      },
      {
        "path": "AccountPage.tsx",
        "purpose": "UI component: AccountPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { FormInput } from '@/components/ui/forms';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport {\n  User,\n  Mail,\n  Shield,\n  Calendar,\n  Save,\n  X,\n  Loader2,\n  CheckCircle2,\n  LogOut,\n  Trash2,\n  Settings,\n} from 'lucide-react';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\n\ninterface AccountPageProps {\n  onClose: () => void;\n}\n\nexport function AccountPage({ onClose }: AccountPageProps) {\n  const { user, updateProfile, signOut } = useAuth();\n  const [name, setName] = useState(user?.user_metadata?.name || '');\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n\n  const getInitials = (name: string) => {\n    if (!name) return 'U';\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getAvatarColor = (name: string) => {\n    const colors = [\n      'bg-gradient-to-br from-blue-500 to-blue-600',\n      'bg-gradient-to-br from-purple-500 to-purple-600',\n      'bg-gradient-to-br from-green-500 to-green-600',\n      'bg-gradient-to-br from-orange-500 to-orange-600',\n      'bg-gradient-to-br from-pink-500 to-pink-600',\n      'bg-gradient-to-br from-indigo-500 to-indigo-600',\n    ];\n    const index = (name?.charCodeAt(0) || 0) % colors.length;\n    return colors[index];\n  };\n\n  const formatDate = (dateString?: string) => {\n    if (!dateString) return 'Unknown';\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  };\n\n  const handleSave = async () => {\n    setError(null);\n    setSuccess(false);\n    setLoading(true);\n\n    const result = await updateProfile({ name });\n\n    if (result.error) {\n      setError(result.error.message || 'Failed to update profile');\n      setLoading(false);\n    } else {\n      setSuccess(true);\n      setLoading(false);\n      setTimeout(() => setSuccess(false), 3000);\n    }\n  };\n\n  const handleSignOut = async () => {\n    await signOut();\n    onClose();\n  };\n\n  const handleDeleteAccount = () => {\n    // In a real app, this would call a backend endpoint to delete the account\n    alert(\n      'Account deletion would be implemented here with proper confirmation and backend integration.'\n    );\n    setShowDeleteDialog(false);\n  };\n\n  if (!user) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 dark:bg-black/70\">\n      <div className=\"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-2xl bg-white shadow-2xl dark:bg-slate-800\">\n        {/* Header */}\n        <div className=\"sticky top-0 rounded-t-2xl bg-[var(--primary)] p-6 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Settings className=\"h-8 w-8\" />\n              <div>\n                <h2 className=\"text-2xl font-bold\">Account Settings</h2>\n                <p className=\"text-sm text-white/80\">Manage your account information</p>\n              </div>\n            </div>\n            <Button\n              onClick={onClose}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"rounded-full text-white hover:bg-white/20\"\n            >\n              <X className=\"size-5\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"space-y-6 p-6\">\n          {/* Success/Error Messages */}\n          {success && (\n            <Alert className=\"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20\">\n              <CheckCircle2 className=\"size-4 text-green-600 dark:text-green-400\" />\n              <AlertDescription className=\"text-green-800 dark:text-green-300\">\n                Profile updated successfully!\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n\n          {/* Profile Section */}\n          <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n            <h3 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n              <User className=\"size-5\" />\n              Profile Information\n            </h3>\n\n            <div className=\"mb-6 flex items-start gap-6\">\n              <Avatar\n                className={`size-20 ${getAvatarColor(user.user_metadata?.name || user.email || '')} text-white shadow-lg`}\n              >\n                <AvatarFallback className=\"text-2xl font-bold\">\n                  {getInitials(user.user_metadata?.name || user.email || '')}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1\">\n                <p className=\"mb-1 text-sm text-gray-600 dark:text-gray-400\">Display Name</p>\n                <FormInput\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"Your name\"\n                  containerClassName=\"mb-3\"\n                />\n                <Button\n                  onClick={handleSave}\n                  disabled={loading || name === (user.user_metadata?.name || '')}\n                  size=\"sm\"\n                  className=\"bg-[var(--primary)] text-white hover:opacity-90\"\n                >\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"mr-2 size-4\" />\n                      Save Changes\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Account Details */}\n          <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n            <h3 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n              <Shield className=\"size-5\" />\n              Account Details\n            </h3>\n\n            <div className=\"space-y-4\">\n              {/* Email */}\n              <div>\n                <FormInput\n                  label=\"Email Address\"\n                  leftIcon={<Mail className=\"size-4\" />}\n                  value={user.email}\n                  disabled\n                  description=\"Email cannot be changed in this demo\"\n                />\n              </div>\n\n              {/* User ID */}\n              <div>\n                <FormInput\n                  label=\"User ID\"\n                  leftIcon={<Shield className=\"size-4\" />}\n                  value={user.id}\n                  disabled\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n\n              {/* Account Created */}\n              <div>\n                <FormInput\n                  label=\"Account Created\"\n                  leftIcon={<Calendar className=\"size-4\" />}\n                  value={formatDate(user.created_at)}\n                  disabled\n                />\n              </div>\n\n              {/* Role */}\n              <div>\n                <FormInput\n                  label=\"Account Role\"\n                  leftIcon={<Shield className=\"size-4\" />}\n                  value={user.user_metadata?.role || 'User'}\n                  disabled\n                  className=\"capitalize\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Danger Zone */}\n          <div className=\"rounded-xl border border-red-200 bg-red-50 p-6 dark:border-red-800 dark:bg-red-900/20\">\n            <h3 className=\"mb-4 text-lg font-semibold text-red-900 dark:text-red-300\">\n              Danger Zone\n            </h3>\n\n            <div className=\"space-y-3\">\n              <Button\n                onClick={handleSignOut}\n                variant=\"outline\"\n                className=\"w-full justify-start border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30\"\n              >\n                <LogOut className=\"mr-2 size-4\" />\n                Sign Out\n              </Button>\n\n              <Button\n                onClick={() => setShowDeleteDialog(true)}\n                variant=\"outline\"\n                className=\"w-full justify-start border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30\"\n              >\n                <Trash2 className=\"mr-2 size-4\" />\n                Delete Account\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Delete Account Confirmation Dialog */}\n      <Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Delete Account</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete your account? This action cannot be undone. All your\n              data, including projects, tasks, and settings will be permanently deleted.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowDeleteDialog(false)}>\n              Cancel\n            </Button>\n            <Button variant=\"destructive\" onClick={handleDeleteAccount}>\n              <Trash2 className=\"mr-2 size-4\" />\n              Delete Account\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n",
        "exports": [
          "AccountPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/forms",
          "@/components/ui/alert",
          "lucide-react",
          "@/components/ui/avatar",
          "@/components/ui/dialog"
        ],
        "lineCount": 299
      },
      {
        "path": "AuthRouter.tsx",
        "purpose": "UI component: AuthRouter",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { LoginPage } from './LoginPage';\nimport { SignupPage } from './SignupPage';\nimport { PasswordResetPage } from './PasswordResetPage';\n\ntype AuthView = 'login' | 'signup' | 'reset';\n\nexport function AuthRouter() {\n  const [view, setView] = useState<AuthView>('login');\n\n  switch (view) {\n    case 'login':\n      return (\n        <LoginPage\n          onSwitchToSignup={() => setView('signup')}\n          onSwitchToReset={() => setView('reset')}\n        />\n      );\n    case 'signup':\n      return <SignupPage onSwitchToLogin={() => setView('login')} />;\n    case 'reset':\n      return <PasswordResetPage onSwitchToLogin={() => setView('login')} />;\n  }\n}\n",
        "exports": [
          "AuthRouter"
        ],
        "imports": [
          "react"
        ],
        "lineCount": 26
      },
      {
        "path": "EnhancedAccountPage.tsx",
        "purpose": "UI component: EnhancedAccountPage",
        "role": "component",
        "content": "'use client';\nimport { useState, useEffect } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { useOrganization } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { FormInput, FormTextarea } from '@/components/ui/forms';\nimport { toast } from 'sonner';\nimport {\n  User,\n  Mail,\n  Shield,\n  Calendar,\n  Save,\n  X,\n  Loader2,\n  CheckCircle2,\n  LogOut,\n  Trash2,\n  Settings,\n  Activity,\n  Bell,\n  Lock,\n  Eye,\n  EyeOff,\n  Clock,\n  Key,\n  Users,\n  UsersRound,\n  UserCog,\n  FolderKanban,\n  Folder,\n} from 'lucide-react';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { ActivityListSkeleton } from '@/components/skeletons';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Switch } from '@/components/ui/switch';\nimport { getSupabaseClient } from '../../lib/supabase';\nimport { PreferencesTab } from '../PreferencesTab';\nimport { TeamManagement } from '../settings/TeamManagement';\nimport { TeamsManagement } from '../settings/TeamsManagement';\nimport { ProjectManagement } from '../settings/ProjectManagement';\nimport { ProjectMembersManagement } from '../settings/ProjectMembersManagement';\nimport { UserManagement } from '../settings/UserManagement';\nimport { WorkspacesManagement } from '../settings/WorkspacesManagement';\nimport { useAuthorization } from '@/hooks/useAuthorization';\nimport { useUserProfile, useUserActivity, useUpdateProfile } from '@/hooks/queries';\n\nconst supabase = getSupabaseClient();\n\ninterface AccountPageProps {\n  onClose: () => void;\n  onWorkspacesChanged?: () => void;\n  onOrganizationCreated?: () => void;\n}\n\ntype TabType =\n  | 'profile'\n  | 'security'\n  | 'preferences'\n  | 'members'\n  | 'team'\n  | 'teams'\n  | 'projects'\n  | 'workspaces'\n  | 'users'\n  | 'activity';\n\ninterface UserActivity {\n  id: string;\n  action: string;\n  actorId: string | null;\n  actorName?: string;\n  metadata: Record<string, unknown>;\n  createdAt: string;\n}\n\ninterface UserPreferences {\n  emailNotifications: boolean;\n  theme: 'light' | 'dark' | 'system';\n  language: string;\n}\n\nexport function EnhancedAccountPage({\n  onClose,\n  onWorkspacesChanged,\n  onOrganizationCreated,\n}: AccountPageProps) {\n  const { user, updateProfile, signOut } = useAuth();\n  const { currentUserRole, can } = useAuthorization();\n  const canAccessUserManagement = can.editUserRoles();\n  const [activeTab, setActiveTab] = useState<TabType>('profile');\n  const [name, setName] = useState(user?.user_metadata?.name || '');\n  const [bio, setBio] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [changingPassword, setChangingPassword] = useState(false);\n\n  // Use TanStack Query hooks for profile and activity\n  const { data: profileData, isLoading: loadingBio } = useUserProfile();\n  const { data: activityData = [], isLoading: loadingActivities } = useUserActivity(1, {\n    enabled: activeTab === 'activity',\n  });\n  const updateProfileMutation = useUpdateProfile();\n\n  // Derive activities from query data\n  const activities = activityData as UserActivity[];\n\n  // Password change states\n  const [currentPassword, setCurrentPassword] = useState('');\n  const [newPassword, setNewPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\n  const [showNewPassword, setShowNewPassword] = useState(false);\n\n  // Preferences\n  const [preferences, setPreferences] = useState<UserPreferences>({\n    emailNotifications: true,\n    theme: 'system',\n    language: 'en',\n  });\n\n  // Sync bio from profile data\n  useEffect(() => {\n    if (profileData?.bio) {\n      setBio(profileData.bio);\n    }\n  }, [profileData?.bio]);\n\n  const getInitials = (name: string) => {\n    if (!name) return 'U';\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getAvatarColor = (name: string) => {\n    const colors = [\n      'bg-[var(--primary)]',\n      'bg-gradient-to-br from-purple-500 to-purple-600',\n      'bg-gradient-to-br from-green-500 to-green-600',\n      'bg-gradient-to-br from-orange-500 to-orange-600',\n      'bg-gradient-to-br from-pink-500 to-pink-600',\n      'bg-gradient-to-br from-indigo-500 to-indigo-600',\n    ];\n    const index = (name?.charCodeAt(0) || 0) % colors.length;\n    return colors[index];\n  };\n\n  const formatDate = (dateString?: string) => {\n    if (!dateString) return 'Unknown';\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  };\n\n  const formatDateTime = (dateString: string) => {\n    return new Date(dateString).toLocaleString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: 'numeric',\n      minute: '2-digit',\n    });\n  };\n\n  const getActivityIcon = (action: string) => {\n    switch (action) {\n      case 'account_created':\n        return <User className=\"size-4\" />;\n      case 'profile_updated':\n        return <Save className=\"size-4\" />;\n      case 'password_changed':\n        return <Lock className=\"size-4\" />;\n      case 'role_updated':\n        return <Shield className=\"size-4\" />;\n      default:\n        return <Activity className=\"size-4\" />;\n    }\n  };\n\n  const getActivityLabel = (action: string) => {\n    const labels: Record<string, string> = {\n      account_created: 'Account Created',\n      profile_updated: 'Profile Updated',\n      password_changed: 'Password Changed',\n      role_updated: 'Role Updated',\n      login: 'Logged In',\n      logout: 'Logged Out',\n    };\n    return labels[action] || action;\n  };\n\n  const handleSaveProfile = async () => {\n    setError(null);\n    setSuccess(false);\n\n    // Use mutation for optimistic updates and caching\n    updateProfileMutation.mutate(\n      { name, bio },\n      {\n        onSuccess: async () => {\n          // Also update auth metadata for name (for display consistency)\n          await updateProfile({ name });\n          setSuccess(true);\n          setTimeout(() => setSuccess(false), 3000);\n        },\n        onError: (err) => {\n          setError(err.message || 'Failed to update profile');\n        },\n      }\n    );\n  };\n\n  const handleChangePassword = async () => {\n    setError(null);\n    setSuccess(false);\n\n    if (newPassword !== confirmPassword) {\n      setError('Passwords do not match');\n      return;\n    }\n\n    if (newPassword.length < 6) {\n      setError('Password must be at least 6 characters');\n      return;\n    }\n\n    setChangingPassword(true);\n\n    try {\n      const { error } = await supabase.auth.updateUser({\n        password: newPassword,\n      });\n\n      if (error) {\n        setError(error.message);\n      } else {\n        setSuccess(true);\n        setCurrentPassword('');\n        setNewPassword('');\n        setConfirmPassword('');\n        toast.success('Password changed successfully');\n        setTimeout(() => setSuccess(false), 3000);\n      }\n    } catch (err) {\n      setError('Failed to change password');\n    } finally {\n      setChangingPassword(false);\n    }\n  };\n\n  const handleSavePreferences = async () => {\n    // Color theme is saved to localStorage by PreferencesTab via setColorTheme\n    // Just show success feedback\n    setError(null);\n    setSuccess(true);\n    toast.success('Preferences saved successfully');\n    setTimeout(() => setSuccess(false), 3000);\n  };\n\n  const handleSignOut = async () => {\n    await signOut();\n    onClose();\n  };\n\n  const handleDeleteAccount = () => {\n    alert(\n      'Account deletion would be implemented here with proper confirmation and backend integration.'\n    );\n    setShowDeleteDialog(false);\n  };\n\n  if (!user) return null;\n\n  // Use centralized authorization - super_admin, owner, and admin can manage\n  const canManageTeams = can.editOrganization();\n  const canManageMembers = can.editOrganization();\n  const canManageProjects = can.editProject();\n  const canManageWorkspaces = can.editWorkspace();\n\n  // All users can view their workspaces, teams, and projects (but only items they belong to)\n  const tabs = [\n    { id: 'profile' as TabType, label: 'Profile', icon: User },\n    { id: 'security' as TabType, label: 'Security', icon: Lock },\n    { id: 'preferences' as TabType, label: 'Preferences', icon: Settings },\n    // Members tab removed. Access via User Management.\n    { id: 'workspaces' as TabType, label: 'Workspaces', icon: Folder },\n    { id: 'teams' as TabType, label: 'Teams', icon: UsersRound },\n    { id: 'projects' as TabType, label: 'Projects', icon: FolderKanban },\n    ...(canAccessUserManagement ? [{ id: 'users' as TabType, label: 'Users', icon: UserCog }] : []),\n    { id: 'activity' as TabType, label: 'Activity', icon: Activity },\n  ];\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-2 sm:p-4 dark:bg-black/70\">\n      <div className=\"flex max-h-[95vh] w-full max-w-6xl flex-col overflow-hidden rounded-xl bg-white shadow-2xl sm:max-h-[90vh] sm:rounded-2xl dark:bg-slate-800\">\n        {/* Header */}\n        <div className=\"bg-[var(--primary)] p-4 text-white sm:p-6\">\n          <div className=\"flex items-start justify-between gap-3\">\n            <div className=\"flex min-w-0 items-center gap-3 sm:gap-4\">\n              <Settings className=\"h-6 w-6 flex-shrink-0 sm:h-8 sm:w-8\" />\n              <div className=\"min-w-0\">\n                <h2 className=\"truncate text-lg font-bold sm:text-2xl\">Account Settings</h2>\n                <p className=\"truncate text-xs text-white/80 sm:text-sm\">\n                  Manage your account and preferences\n                </p>\n              </div>\n            </div>\n            <div className=\"flex flex-shrink-0 items-center gap-1 sm:gap-2\">\n              <Button\n                onClick={onClose}\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"-mr-1 rounded-full text-white hover:bg-white/20 sm:mr-0\"\n              >\n                <X className=\"size-5\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200 bg-gray-50 dark:border-slate-700 dark:bg-slate-900/50\">\n          <div className=\"scrollbar-hide flex overflow-x-auto px-4 sm:px-6\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`flex flex-shrink-0 items-center gap-1.5 border-b-2 px-3 py-3 text-xs font-medium whitespace-nowrap transition-colors sm:gap-2 sm:px-4 sm:text-sm ${\n                    activeTab === tab.id\n                      ? 'border-[var(--primary)] text-[var(--primary)]'\n                      : 'border-transparent text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200'\n                  }`}\n                >\n                  <Icon className=\"size-4\" />\n                  {tab.label}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {/* Success/Error Messages */}\n          {success && (\n            <Alert className=\"mb-6 border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20\">\n              <CheckCircle2 className=\"size-4 text-green-600 dark:text-green-400\" />\n              <AlertDescription className=\"text-green-800 dark:text-green-300\">\n                Changes saved successfully!\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {error && (\n            <Alert variant=\"destructive\" className=\"mb-6\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n\n          {/* Profile Tab */}\n          {activeTab === 'profile' && (\n            <div className=\"space-y-6\">\n              <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n                <h3 className=\"mb-4 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n                  Profile Information\n                </h3>\n\n                <div className=\"mb-6 flex items-start gap-6\">\n                  <Avatar\n                    className={`size-24 ${getAvatarColor(user.user_metadata?.name || user.email || '')} text-white shadow-lg`}\n                  >\n                    <AvatarFallback className=\"text-3xl font-bold\">\n                      {getInitials(user.user_metadata?.name || user.email || '')}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1 space-y-4\">\n                    <FormInput\n                      label=\"Display Name\"\n                      value={name}\n                      onChange={(e) => setName(e.target.value)}\n                      placeholder=\"Your name\"\n                    />\n                    <div>\n                      {loadingBio ? (\n                        <div className=\"space-y-2\">\n                          <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                            Bio\n                          </span>\n                          <Skeleton className=\"h-4 w-full\" />\n                          <Skeleton className=\"h-4 w-3/4\" />\n                          <Skeleton className=\"h-4 w-1/2\" />\n                        </div>\n                      ) : (\n                        <FormTextarea\n                          label=\"Bio\"\n                          value={bio}\n                          onChange={(e) => setBio(e.target.value)}\n                          placeholder=\"Tell us about yourself\"\n                          rows={3}\n                        />\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                <Button\n                  onClick={handleSaveProfile}\n                  disabled={updateProfileMutation.isPending}\n                  className=\"bg-[var(--primary)] text-white hover:opacity-90\"\n                >\n                  {updateProfileMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"mr-2 size-4\" />\n                      Save Changes\n                    </>\n                  )}\n                </Button>\n              </div>\n\n              <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n                <h3 className=\"mb-4 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n                  Account Details\n                </h3>\n\n                <div className=\"space-y-4\">\n                  <FormInput\n                    label=\"Email Address\"\n                    leftIcon={<Mail className=\"size-4\" />}\n                    value={user.email}\n                    disabled\n                    className=\"cursor-not-allowed bg-gray-100 dark:bg-slate-800\"\n                  />\n\n                  <FormInput\n                    label=\"Account Role\"\n                    leftIcon={<Shield className=\"size-4\" />}\n                    value={(user.user_metadata?.role || 'member')\n                      .split('_')\n                      .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))\n                      .join(' ')}\n                    disabled\n                    className=\"cursor-not-allowed bg-gray-100 dark:bg-slate-800\"\n                  />\n\n                  <FormInput\n                    label=\"Member Since\"\n                    leftIcon={<Calendar className=\"size-4\" />}\n                    value={formatDate(user.created_at)}\n                    disabled\n                    className=\"cursor-not-allowed bg-gray-100 dark:bg-slate-800\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Security Tab */}\n          {activeTab === 'security' && (\n            <div className=\"space-y-6\">\n              <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n                <h3 className=\"mb-4 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n                  Change Password\n                </h3>\n\n                <div className=\"space-y-4\">\n                  <FormInput\n                    label=\"Current Password\"\n                    type={showCurrentPassword ? 'text' : 'password'}\n                    value={currentPassword}\n                    onChange={(e) => setCurrentPassword(e.target.value)}\n                    placeholder=\"Enter current password\"\n                    leftIcon={<Lock className=\"size-4 text-gray-400\" />}\n                    rightIcon={\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                        className=\"text-gray-400 hover:text-gray-600\"\n                      >\n                        {showCurrentPassword ? (\n                          <EyeOff className=\"size-4\" />\n                        ) : (\n                          <Eye className=\"size-4\" />\n                        )}\n                      </button>\n                    }\n                  />\n\n                  <FormInput\n                    label=\"New Password\"\n                    type={showNewPassword ? 'text' : 'password'}\n                    value={newPassword}\n                    onChange={(e) => setNewPassword(e.target.value)}\n                    placeholder=\"Enter new password\"\n                    leftIcon={<Key className=\"size-4 text-gray-400\" />}\n                    rightIcon={\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowNewPassword(!showNewPassword)}\n                        className=\"text-gray-400 hover:text-gray-600\"\n                      >\n                        {showNewPassword ? (\n                          <EyeOff className=\"size-4\" />\n                        ) : (\n                          <Eye className=\"size-4\" />\n                        )}\n                      </button>\n                    }\n                  />\n\n                  <FormInput\n                    label=\"Confirm New Password\"\n                    type=\"password\"\n                    value={confirmPassword}\n                    onChange={(e) => setConfirmPassword(e.target.value)}\n                    placeholder=\"Confirm new password\"\n                    leftIcon={<Key className=\"size-4 text-gray-400\" />}\n                  />\n\n                  <Button\n                    onClick={handleChangePassword}\n                    disabled={\n                      changingPassword || !currentPassword || !newPassword || !confirmPassword\n                    }\n                    className=\"bg-[var(--primary)] text-white hover:opacity-90\"\n                  >\n                    {changingPassword ? (\n                      <>\n                        <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                        Changing...\n                      </>\n                    ) : (\n                      <>\n                        <Lock className=\"mr-2 size-4\" />\n                        Change Password\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"rounded-xl border border-red-200 bg-red-50 p-6 dark:border-red-800 dark:bg-red-900/20\">\n                <h3 className=\"mb-4 text-lg font-semibold text-red-900 dark:text-red-300\">\n                  Danger Zone\n                </h3>\n\n                <div className=\"space-y-3\">\n                  <Button\n                    onClick={handleSignOut}\n                    variant=\"outline\"\n                    className=\"w-full justify-start border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30\"\n                  >\n                    <LogOut className=\"mr-2 size-4\" />\n                    Sign Out\n                  </Button>\n\n                  <Button\n                    onClick={() => setShowDeleteDialog(true)}\n                    variant=\"outline\"\n                    className=\"w-full justify-start border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30\"\n                  >\n                    <Trash2 className=\"mr-2 size-4\" />\n                    Delete Account\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Preferences Tab */}\n          {activeTab === 'preferences' && (\n            <PreferencesTab\n              emailNotifications={preferences.emailNotifications}\n              onEmailNotificationsChange={(checked) =>\n                setPreferences({ ...preferences, emailNotifications: checked })\n              }\n              onSave={handleSavePreferences}\n              loading={false}\n            />\n          )}\n\n          {/* Members Tab - Workspace Member Management (Owners/Admins only) */}\n          {/* Members tab removed. Access via User Management. */}\n\n          {/* Team Tab - Organization Members (Owners/Admins only) */}\n          {activeTab === 'team' && canManageMembers && <TeamManagement />}\n\n          {/* Workspaces Tab - All users can view their workspaces */}\n          {activeTab === 'workspaces' && (\n            <WorkspacesManagement onWorkspacesChanged={onWorkspacesChanged} />\n          )}\n\n          {/* Teams Tab - All users can view their teams */}\n          {activeTab === 'teams' && <TeamsManagement />}\n\n          {/* Projects Tab - All users can view their projects */}\n          {activeTab === 'projects' && (\n            <div className=\"space-y-6\">\n              <ProjectManagement />\n              <ProjectMembersManagement />\n            </div>\n          )}\n\n          {/* Users Tab - User Management (Owners/Admins only) */}\n          {activeTab === 'users' && canAccessUserManagement && (\n            <UserManagement onOrganizationCreated={onOrganizationCreated} />\n          )}\n\n          {/* Activity Tab */}\n          {activeTab === 'activity' && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-xl bg-gray-50 p-6 dark:bg-slate-900\">\n                <h3 className=\"mb-4 flex items-center gap-2 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n                  <Clock className=\"size-5\" />\n                  Recent Activity\n                </h3>\n\n                {loadingActivities ? (\n                  <ActivityListSkeleton count={4} />\n                ) : activities.length === 0 ? (\n                  <div className=\"py-8 text-center text-gray-500 dark:text-gray-400\">\n                    No activity yet\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {activities.map((activity) => (\n                      <div\n                        key={activity.id}\n                        className=\"flex items-start gap-3 rounded-lg border border-gray-200 bg-white p-3 dark:border-slate-700 dark:bg-slate-800\"\n                      >\n                        <div className=\"rounded-lg bg-[var(--primary)]/10 p-2 text-[var(--primary)]\">\n                          {getActivityIcon(activity.action)}\n                        </div>\n                        <div className=\"min-w-0 flex-1\">\n                          <p className=\"font-medium text-gray-900 dark:text-gray-100\">\n                            {getActivityLabel(activity.action)}\n                          </p>\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                            {formatDateTime(activity.createdAt)}\n                            {activity.actorName && activity.actorId !== activity.id && (\n                              <span className=\"ml-1\">by {activity.actorName}</span>\n                            )}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Delete Account Confirmation Dialog */}\n      <Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Delete Account</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete your account? This action cannot be undone. All your\n              data, including projects, tasks, and settings will be permanently deleted.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowDeleteDialog(false)}>\n              Cancel\n            </Button>\n            <Button variant=\"destructive\" onClick={handleDeleteAccount}>\n              <Trash2 className=\"mr-2 size-4\" />\n              Delete Account\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n",
        "exports": [
          "EnhancedAccountPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "sonner",
          "lucide-react",
          "@/components/ui/avatar",
          "@/components/ui/skeleton",
          "@/components/skeletons",
          "@/components/ui/dialog",
          "@/components/ui/switch",
          "@/hooks/useAuthorization",
          "@/hooks/queries"
        ],
        "lineCount": 701
      },
      {
        "path": "InitAdminPage.tsx",
        "purpose": "UI component: InitAdminPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { FormInput } from '@/components/ui/forms';\nimport { Crown, Loader2, CheckCircle2, AlertTriangle } from 'lucide-react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { supabaseUrl, publicAnonKey } from '../../lib/supabase';\n\nexport function InitAdminPage() {\n  const [email, setEmail] = useState('');\n  const [secret, setSecret] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n    setSuccess(false);\n\n    try {\n      const response = await fetch(`${supabaseUrl}/functions/v1/make-server-5b1628fb/init-admin`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${publicAnonKey}`,\n        },\n        body: JSON.stringify({ email, secret }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        setSuccess(true);\n        setEmail('');\n        setSecret('');\n      } else {\n        setError(data.error || 'Failed to initialize admin');\n      }\n    } catch (err) {\n      console.error('Init admin error:', err);\n      setError('An error occurred while initializing admin');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4\">\n      <Card className=\"w-full max-w-md bg-white/95 backdrop-blur dark:bg-slate-800/95\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <div className=\"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-yellow-400 to-orange-500\">\n            <Crown className=\"h-6 w-6 text-white\" />\n          </div>\n          <CardTitle className=\"text-2xl\">Initialize Admin User</CardTitle>\n          <CardDescription>Grant admin privileges to a user account</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {success && (\n              <Alert className=\"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20\">\n                <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                <AlertDescription className=\"text-green-800 dark:text-green-300\">\n                  Admin privileges granted successfully! The user can now access admin features.\n                </AlertDescription>\n              </Alert>\n            )}\n\n            {error && (\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            <FormInput\n              id=\"email\"\n              label=\"User Email\"\n              type=\"email\"\n              placeholder=\"<EMAIL>\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n              disabled={loading}\n              description=\"The email address of the user account that should become admin\"\n            />\n            <FormInput\n              id=\"secret\"\n              label=\"Secret Key\"\n              type=\"password\"\n              placeholder=\"Enter secret key\"\n              value={secret}\n              onChange={(e) => setSecret(e.target.value)}\n              required\n              disabled={loading}\n              description='Default: \"change-me-in-production\" (can be set via INIT_ADMIN_SECRET env var)'\n            />\n\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white hover:from-yellow-600 hover:to-orange-600\"\n              disabled={loading}\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Granting Admin Access...\n                </>\n              ) : (\n                <>\n                  <Crown className=\"mr-2 h-4 w-4\" />\n                  Grant Admin Privileges\n                </>\n              )}\n            </Button>\n          </form>\n\n          <div className=\"mt-6 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20\">\n            <h4 className=\"mb-2 text-sm font-semibold text-blue-900 dark:text-blue-300\">\n              Important Notes:\n            </h4>\n            <ul className=\"list-inside list-disc space-y-1 text-xs text-blue-800 dark:text-blue-400\">\n              <li>The user account must already exist (sign up first)</li>\n              <li>You need the correct secret key to grant admin access</li>\n              <li>Once granted, the user can manage all other users and roles</li>\n              <li>For security, consider disabling this endpoint after initial setup</li>\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n",
        "exports": [
          "InitAdminPage"
        ],
        "imports": [
          "react",
          "@/components/ui/button",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "lucide-react",
          "@/components/ui/card"
        ],
        "lineCount": 136
      },
      {
        "path": "LoginPage.tsx",
        "purpose": "UI component: LoginPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { FormInput } from '@/components/ui/forms';\nimport { Eye, EyeOff, LogIn, Mail, Lock, Loader2 } from 'lucide-react';\n\ninterface LoginPageProps {\n  onSwitchToSignup: () => void;\n  onSwitchToReset: () => void;\n}\n\nexport function LoginPage({ onSwitchToSignup, onSwitchToReset }: LoginPageProps) {\n  const { signIn } = useAuth();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n\n    const result = await signIn(email, password);\n\n    if (result.error) {\n      setError(result.error.message || 'Failed to sign in');\n      setLoading(false);\n    } else {\n      // Successful login - the AuthContext will handle the redirect\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 p-4 dark:from-slate-950 dark:via-slate-900 dark:to-slate-800\">\n      <div className=\"w-full max-w-md\">\n        {/* Logo/Brand */}\n        <div className=\"mb-8 text-center\">\n          <div className=\"mb-4 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg\">\n            <svg className=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n              />\n            </svg>\n          </div>\n          <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100\">Welcome Back</h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">Sign in to your ProjectHub account</p>\n        </div>\n\n        {/* Login Card */}\n        <div className=\"rounded-2xl border border-gray-200 bg-white p-8 shadow-xl dark:border-slate-700 dark:bg-slate-800\">\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <Alert variant=\"destructive\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            {/* Email */}\n            <FormInput\n              id=\"email\"\n              label=\"Email Address\"\n              type=\"email\"\n              placeholder=\"<EMAIL>\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              leftIcon={<Mail className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n              required\n              autoFocus\n            />\n\n            {/* Password */}\n            <FormInput\n              id=\"password\"\n              label=\"Password\"\n              type={showPassword ? 'text' : 'password'}\n              placeholder=\"Enter your password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              leftIcon={<Lock className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n              rightIcon={\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  {showPassword ? <EyeOff className=\"size-4\" /> : <Eye className=\"size-4\" />}\n                </button>\n              }\n              required\n            />\n\n            {/* Forgot Password */}\n            <div className=\"flex justify-end\">\n              <button\n                type=\"button\"\n                onClick={onSwitchToReset}\n                className=\"text-sm font-medium text-[var(--primary)] hover:opacity-80\"\n              >\n                Forgot password?\n              </button>\n            </div>\n\n            {/* Submit Button */}\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-[var(--primary)] text-white shadow-lg hover:opacity-90\"\n              disabled={loading}\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                  Signing in...\n                </>\n              ) : (\n                <>\n                  <LogIn className=\"mr-2 size-4\" />\n                  Sign In\n                </>\n              )}\n            </Button>\n          </form>\n\n          {/* Sign Up Link */}\n          <div className=\"mt-6 text-center\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n              Don't have an account?{' '}\n              <button\n                onClick={onSwitchToSignup}\n                className=\"font-medium text-[var(--primary)] hover:opacity-80\"\n              >\n                Sign up\n              </button>\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <p className=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-500\">\n           2024 ProjectHub. Secure authentication powered by Supabase.\n        </p>\n      </div>\n    </div>\n  );\n}\n",
        "exports": [
          "LoginPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "lucide-react"
        ],
        "lineCount": 153
      },
      {
        "path": "PasswordResetPage.tsx",
        "purpose": "UI component: PasswordResetPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { FormInput } from '@/components/ui/forms';\nimport { Mail, ArrowLeft, Loader2, CheckCircle2 } from 'lucide-react';\n\ninterface PasswordResetPageProps {\n  onSwitchToLogin: () => void;\n}\n\nexport function PasswordResetPage({ onSwitchToLogin }: PasswordResetPageProps) {\n  const { resetPassword } = useAuth();\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setSuccess(false);\n    setLoading(true);\n\n    const result = await resetPassword(email);\n\n    if (result.error) {\n      setError(result.error.message || 'Failed to send reset email');\n      setLoading(false);\n    } else {\n      setSuccess(true);\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 p-4 dark:from-slate-950 dark:via-slate-900 dark:to-slate-800\">\n      <div className=\"w-full max-w-md\">\n        {/* Logo/Brand */}\n        <div className=\"mb-8 text-center\">\n          <div className=\"mb-4 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg\">\n            <svg className=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"\n              />\n            </svg>\n          </div>\n          <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100\">\n            Reset Password\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            {success\n              ? 'Check your email for reset instructions'\n              : 'Enter your email to receive a password reset link'}\n          </p>\n        </div>\n\n        {/* Reset Card */}\n        <div className=\"rounded-2xl border border-gray-200 bg-white p-8 shadow-xl dark:border-slate-700 dark:bg-slate-800\">\n          {success ? (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"mb-2 inline-flex h-16 w-16 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <h3 className=\"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n                  Email Sent!\n                </h3>\n                <p className=\"mb-6 text-sm text-gray-600 dark:text-gray-400\">\n                  We've sent a password reset link to <strong>{email}</strong>. Please check your\n                  inbox and follow the instructions to reset your password.\n                </p>\n              </div>\n              <Button onClick={onSwitchToLogin} variant=\"outline\" className=\"w-full\">\n                <ArrowLeft className=\"mr-2 size-4\" />\n                Back to Login\n              </Button>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {error && (\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20\">\n                <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n                  <strong>Note:</strong> Email functionality may be limited in this demo\n                  environment. In production, you would receive an email with a secure reset link.\n                </p>\n              </div>\n\n              {/* Email */}\n              <FormInput\n                id=\"email\"\n                label=\"Email Address\"\n                type=\"email\"\n                placeholder=\"<EMAIL>\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                leftIcon={<Mail className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n                required\n                autoFocus\n              />\n\n              {/* Submit Button */}\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-[var(--primary)] text-white shadow-lg hover:opacity-90\"\n                disabled={loading}\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                    Sending...\n                  </>\n                ) : (\n                  <>\n                    <Mail className=\"mr-2 size-4\" />\n                    Send Reset Link\n                  </>\n                )}\n              </Button>\n\n              {/* Back to Login */}\n              <Button type=\"button\" onClick={onSwitchToLogin} variant=\"ghost\" className=\"w-full\">\n                <ArrowLeft className=\"mr-2 size-4\" />\n                Back to Login\n              </Button>\n            </form>\n          )}\n        </div>\n\n        {/* Footer */}\n        <p className=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-500\">\n          Need help? Contact <EMAIL>\n        </p>\n      </div>\n    </div>\n  );\n}\n",
        "exports": [
          "PasswordResetPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "lucide-react"
        ],
        "lineCount": 147
      },
      {
        "path": "ResetPasswordPage.tsx",
        "purpose": "UI component: ResetPasswordPage",
        "role": "component",
        "content": "'use client';\nimport { useState } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { FormInput } from '@/components/ui/forms';\nimport { Mail, ArrowLeft, Loader2, CheckCircle } from 'lucide-react';\n\ninterface ResetPasswordPageProps {\n  onNavigateToLogin: () => void;\n}\n\nexport function ResetPasswordPage({ onNavigateToLogin }: ResetPasswordPageProps) {\n  const { resetPassword } = useAuth();\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    const { error: resetError } = await resetPassword(email);\n\n    if (resetError) {\n      setError(resetError.message || 'Failed to send reset email');\n      setLoading(false);\n    } else {\n      setSuccess(true);\n      setLoading(false);\n    }\n  };\n\n  if (success) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-4 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"rounded-2xl border border-gray-200 bg-white p-8 text-center shadow-xl dark:border-slate-700 dark:bg-slate-800\">\n            <div className=\"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30\">\n              <CheckCircle className=\"size-8 text-green-600 dark:text-green-400\" />\n            </div>\n            <h2 className=\"mb-3 text-2xl font-bold text-gray-900 dark:text-gray-100\">\n              Check Your Email\n            </h2>\n            <p className=\"mb-6 text-gray-600 dark:text-gray-400\">\n              We've sent a password reset link to <strong>{email}</strong>. Click the link in the\n              email to reset your password.\n            </p>\n            <Button onClick={onNavigateToLogin} variant=\"outline\" className=\"w-full\">\n              <ArrowLeft className=\"mr-2 size-4\" />\n              Back to Login\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-4 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950\">\n      <div className=\"w-full max-w-md\">\n        {/* Header */}\n        <div className=\"mb-8 text-center\">\n          <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 shadow-xl\">\n            <Mail className=\"size-8 text-white\" />\n          </div>\n          <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100\">\n            Reset Password\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Enter your email to receive a password reset link\n          </p>\n        </div>\n\n        {/* Reset Form */}\n        <div className=\"rounded-2xl border border-gray-200 bg-white p-8 shadow-xl dark:border-slate-700 dark:bg-slate-800\">\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <div className=\"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800 dark:border-red-800 dark:bg-red-900/20 dark:text-red-200\">\n                {error}\n              </div>\n            )}\n\n            <FormInput\n              id=\"email\"\n              label=\"Email Address\"\n              type=\"email\"\n              placeholder=\"<EMAIL>\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              leftIcon={<Mail className=\"size-5 text-gray-400 dark:text-gray-500\" />}\n              required\n              autoFocus\n            />\n\n            <Button\n              type=\"submit\"\n              disabled={loading}\n              className=\"h-11 w-full bg-[var(--primary)] text-base font-semibold text-white shadow-lg transition-all hover:opacity-90 hover:shadow-xl\"\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 size-5 animate-spin\" />\n                  Sending...\n                </>\n              ) : (\n                <>\n                  <Mail className=\"mr-2 size-5\" />\n                  Send Reset Link\n                </>\n              )}\n            </Button>\n          </form>\n\n          {/* Back to Login */}\n          <div className=\"mt-6\">\n            <Button type=\"button\" variant=\"ghost\" onClick={onNavigateToLogin} className=\"w-full\">\n              <ArrowLeft className=\"mr-2 size-4\" />\n              Back to Login\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
        "exports": [
          "ResetPasswordPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/forms",
          "lucide-react"
        ],
        "lineCount": 128
      },
      {
        "path": "SignupPage.tsx",
        "purpose": "UI component: SignupPage",
        "role": "component",
        "content": "'use client';\nimport { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { getInvitationByEmail } from '@/app/actions/invites';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { FormInput } from '@/components/ui/forms';\nimport { Eye, EyeOff, UserPlus, Mail, Lock, User, Loader2, CheckCircle2 } from 'lucide-react';\n\ninterface SignupPageProps {\n  onSwitchToLogin: () => void;\n}\n\nexport function SignupPage({ onSwitchToLogin }: SignupPageProps) {\n  const { signUp } = useAuth();\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [checkingEmail, setCheckingEmail] = useState(false);\n  const [nameAutoFilled, setNameAutoFilled] = useState(false);\n\n  // Debounced email lookup for invitation\n  const checkEmailForInvitation = useCallback(async (emailValue: string) => {\n    if (!emailValue || !emailValue.includes('@')) return;\n\n    setCheckingEmail(true);\n    try {\n      const result = await getInvitationByEmail(emailValue);\n      if (result.success && result.hasInvitation) {\n        // Invitation found - just indicate success (user will enter their own name)\n        setNameAutoFilled(true);\n      }\n    } catch {\n      // Silently fail - user can still enter name manually\n    } finally {\n      setCheckingEmail(false);\n    }\n  }, []);\n\n  // Check for invitation when email changes (with debounce)\n  useEffect(() => {\n    // Reset auto-fill state when email changes\n    if (nameAutoFilled) {\n      setNameAutoFilled(false);\n    }\n\n    const timeoutId = setTimeout(() => {\n      checkEmailForInvitation(email);\n    }, 500); // 500ms debounce\n\n    return () => clearTimeout(timeoutId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [email]);\n\n  const validatePassword = (pwd: string) => {\n    if (pwd.length < 8) return 'Password must be at least 8 characters';\n    if (!/[A-Z]/.test(pwd)) return 'Password must contain at least one uppercase letter';\n    if (!/[a-z]/.test(pwd)) return 'Password must contain at least one lowercase letter';\n    if (!/[0-9]/.test(pwd)) return 'Password must contain at least one number';\n    return null;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    // Validation\n    if (!name.trim()) {\n      setError('Name is required');\n      return;\n    }\n\n    const passwordError = validatePassword(password);\n    if (passwordError) {\n      setError(passwordError);\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      setError('Passwords do not match');\n      return;\n    }\n\n    setLoading(true);\n\n    const result = await signUp(email, password, name);\n\n    if (result.error) {\n      setError(result.error.message || 'Failed to sign up');\n      setLoading(false);\n    } else {\n      // Successful signup - the AuthContext will handle the redirect\n      setLoading(false);\n    }\n  };\n\n  const passwordStrength = () => {\n    if (password.length === 0) return 0;\n    let strength = 0;\n    if (password.length >= 8) strength++;\n    if (/[A-Z]/.test(password)) strength++;\n    if (/[a-z]/.test(password)) strength++;\n    if (/[0-9]/.test(password)) strength++;\n    if (/[^A-Za-z0-9]/.test(password)) strength++;\n    return strength;\n  };\n\n  const strength = passwordStrength();\n  const strengthColor =\n    strength <= 2\n      ? 'bg-red-500'\n      : strength === 3\n        ? 'bg-amber-500'\n        : strength === 4\n          ? 'bg-blue-500'\n          : 'bg-green-500';\n  const strengthText =\n    strength <= 2 ? 'Weak' : strength === 3 ? 'Fair' : strength === 4 ? 'Good' : 'Strong';\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 p-4 dark:from-slate-950 dark:via-slate-900 dark:to-slate-800\">\n      <div className=\"w-full max-w-md\">\n        {/* Logo/Brand */}\n        <div className=\"mb-8 text-center\">\n          <div className=\"mb-4 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg\">\n            <UserPlus className=\"h-8 w-8\" />\n          </div>\n          <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100\">\n            Create Account\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Join ProjectHub and start managing your projects\n          </p>\n        </div>\n\n        {/* Signup Card */}\n        <div className=\"rounded-2xl border border-gray-200 bg-white p-8 shadow-xl dark:border-slate-700 dark:bg-slate-800\">\n          <form onSubmit={handleSubmit} className=\"space-y-5\">\n            {error && (\n              <Alert variant=\"destructive\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            {/* Email - First so we can look up invitation */}\n            <FormInput\n              id=\"email\"\n              label=\"Email Address\"\n              type=\"email\"\n              placeholder=\"<EMAIL>\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              leftIcon={<Mail className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n              rightIcon={\n                checkingEmail ? (\n                  <Loader2 className=\"size-4 animate-spin text-gray-400\" />\n                ) : undefined\n              }\n              required\n              autoFocus\n            />\n\n            {/* Name - Auto-filled from invitation if found */}\n            <FormInput\n              id=\"name\"\n              label=\"Full Name\"\n              description={nameAutoFilled ? 'Auto-filled from invitation' : undefined}\n              type=\"text\"\n              placeholder=\"John Doe\"\n              value={name}\n              onChange={(e) => {\n                setName(e.target.value);\n                setNameAutoFilled(false);\n              }}\n              leftIcon={<User className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n              rightIcon={\n                nameAutoFilled ? <CheckCircle2 className=\"size-4 text-green-500\" /> : undefined\n              }\n              required\n            />\n\n            {/* Password */}\n            <div className=\"space-y-2\">\n              <FormInput\n                id=\"password\"\n                label=\"Password\"\n                type={showPassword ? 'text' : 'password'}\n                placeholder=\"Create a strong password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                leftIcon={<Lock className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n                rightIcon={\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                  >\n                    {showPassword ? <EyeOff className=\"size-4\" /> : <Eye className=\"size-4\" />}\n                  </button>\n                }\n                required\n              />\n\n              {/* Password Strength */}\n              {password.length > 0 && (\n                <div className=\"space-y-1\">\n                  <div className=\"flex gap-1\">\n                    {[1, 2, 3, 4, 5].map((i) => (\n                      <div\n                        key={i}\n                        className={`h-1 flex-1 rounded-full transition-colors ${\n                          i <= strength ? strengthColor : 'bg-gray-200 dark:bg-gray-700'\n                        }`}\n                      />\n                    ))}\n                  </div>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                    Password strength: <span className=\"font-medium\">{strengthText}</span>\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Confirm Password */}\n            <FormInput\n              id=\"confirmPassword\"\n              label=\"Confirm Password\"\n              type={showPassword ? 'text' : 'password'}\n              placeholder=\"Confirm your password\"\n              value={confirmPassword}\n              onChange={(e) => setConfirmPassword(e.target.value)}\n              leftIcon={<Lock className=\"size-4 text-gray-400 dark:text-gray-500\" />}\n              rightIcon={\n                confirmPassword && password === confirmPassword ? (\n                  <CheckCircle2 className=\"size-4 text-green-500\" />\n                ) : undefined\n              }\n              required\n            />\n\n            {/* Password Requirements */}\n            <div className=\"space-y-1 rounded-lg bg-gray-50 p-3 dark:bg-slate-900\">\n              <p className=\"mb-2 text-xs font-medium text-gray-700 dark:text-gray-300\">\n                Password must contain:\n              </p>\n              <div className=\"space-y-1\">\n                {[\n                  { test: password.length >= 8, text: 'At least 8 characters' },\n                  {\n                    test: /[A-Z]/.test(password),\n                    text: 'One uppercase letter',\n                  },\n                  {\n                    test: /[a-z]/.test(password),\n                    text: 'One lowercase letter',\n                  },\n                  { test: /[0-9]/.test(password), text: 'One number' },\n                ].map((req, i) => (\n                  <div key={i} className=\"flex items-center gap-2 text-xs\">\n                    <div\n                      className={`h-1.5 w-1.5 rounded-full ${req.test ? 'bg-green-500' : 'bg-gray-300 dark:bg-gray-600'}`}\n                    />\n                    <span\n                      className={\n                        req.test\n                          ? 'text-green-600 dark:text-green-400'\n                          : 'text-gray-500 dark:text-gray-400'\n                      }\n                    >\n                      {req.text}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Submit Button */}\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-[var(--primary)] text-white shadow-lg hover:opacity-90\"\n              disabled={loading}\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                  Creating account...\n                </>\n              ) : (\n                <>\n                  <UserPlus className=\"mr-2 size-4\" />\n                  Create Account\n                </>\n              )}\n            </Button>\n          </form>\n\n          {/* Login Link */}\n          <div className=\"mt-6 text-center\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n              Already have an account?{' '}\n              <button\n                onClick={onSwitchToLogin}\n                className=\"font-medium text-[var(--primary)] hover:opacity-80\"\n              >\n                Sign in\n              </button>\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <p className=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-500\">\n          By signing up, you agree to our Terms of Service and Privacy Policy\n        </p>\n      </div>\n    </div>\n  );\n}\n",
        "exports": [
          "SignupPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/app/actions/invites",
          "@/components/ui/button",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "lucide-react"
        ],
        "lineCount": 323
      },
      {
        "path": "UserManagementPage.tsx",
        "purpose": "UI component: UserManagementPage",
        "role": "component",
        "content": "'use client';\nimport { useState, useEffect } from 'react';\nimport { useAuth } from '@/app/providers';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { SearchInput } from '@/components/ui/forms';\nimport {\n  Users,\n  Shield,\n  Mail,\n  Calendar,\n  Loader2,\n  X,\n  Settings,\n  Edit2,\n  Crown,\n  User,\n} from 'lucide-react';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { UserManagementSkeleton, AuthLoadingSkeleton } from '@/components/skeletons';\nimport { getSupabaseClient, supabaseUrl } from '../../lib/supabase';\n\nconst supabase = getSupabaseClient();\n\ninterface UserManagementPageProps {\n  onClose: () => void;\n}\n\ninterface UserProfile {\n  id: string;\n  email: string;\n  name: string;\n  role: 'super_admin' | 'owner' | 'admin' | 'manager' | 'developer' | 'viewer';\n  createdAt: string;\n  preferences?: any;\n}\n\nexport function UserManagementPage({ onClose }: UserManagementPageProps) {\n  const { user } = useAuth();\n  const [users, setUsers] = useState<UserProfile[]>([]);\n  const [filteredUsers, setFilteredUsers] = useState<UserProfile[]>([]);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<UserProfile | null>(null);\n  const [showRoleDialog, setShowRoleDialog] = useState(false);\n  const [newRole, setNewRole] = useState<string>('');\n  const [updating, setUpdating] = useState(false);\n  const [currentUserRole, setCurrentUserRole] = useState<string | null>(null);\n  const [roleLoading, setRoleLoading] = useState(true);\n\n  // Fetch the current user's role directly from the database to avoid cached state issues\n  useEffect(() => {\n    const fetchCurrentUserRole = async () => {\n      if (!user?.id) {\n        setRoleLoading(false);\n        return;\n      }\n      try {\n        const { data: profile } = (await supabase\n          .from('profiles')\n          .select('role')\n          .eq('id', user.id)\n          .single()) as { data: { role: string | null } | null };\n        setCurrentUserRole(profile?.role || null);\n      } catch (err) {\n        console.error('Error fetching current user role:', err);\n      } finally {\n        setRoleLoading(false);\n      }\n    };\n    fetchCurrentUserRole();\n  }, [user?.id]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  useEffect(() => {\n    if (searchQuery) {\n      const filtered = users.filter(\n        (u) =>\n          u.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n          u.email.toLowerCase().includes(searchQuery.toLowerCase()) ||\n          u.role.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n      setFilteredUsers(filtered);\n    } else {\n      setFilteredUsers(users);\n    }\n  }, [searchQuery, users]);\n\n  const fetchUsers = async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession();\n      if (!session) {\n        setError('Not authenticated');\n        setLoading(false);\n        return;\n      }\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/make-server-5b1628fb/users`, {\n        headers: {\n          Authorization: `Bearer ${session.access_token}`,\n        },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setUsers(data.users || []);\n        setFilteredUsers(data.users || []);\n      } else if (response.status === 403) {\n        setError('You do not have permission to view users. Admin access required.');\n      } else {\n        setError('Failed to load users');\n      }\n    } catch (err) {\n      console.error('Failed to fetch users:', err);\n      setError('An error occurred while loading users');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleOpenRoleDialog = (userProfile: UserProfile) => {\n    setSelectedUser(userProfile);\n    setNewRole(userProfile.role);\n    setShowRoleDialog(true);\n  };\n\n  const handleUpdateRole = async () => {\n    if (!selectedUser || !newRole) return;\n\n    setUpdating(true);\n    setError(null);\n\n    try {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession();\n      if (!session) {\n        setError('Not authenticated');\n        setUpdating(false);\n        return;\n      }\n\n      const response = await fetch(\n        `${supabaseUrl}/functions/v1/make-server-5b1628fb/users/${selectedUser.id}/role`,\n        {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${session.access_token}`,\n          },\n          body: JSON.stringify({ role: newRole }),\n        }\n      );\n\n      if (response.ok) {\n        setSuccess(true);\n        setTimeout(() => setSuccess(false), 3000);\n        setShowRoleDialog(false);\n        fetchUsers(); // Refresh user list\n      } else {\n        const data = await response.json();\n        setError(data.error || 'Failed to update role');\n      }\n    } catch (err) {\n      console.error('Failed to update role:', err);\n      setError('An error occurred while updating role');\n    } finally {\n      setUpdating(false);\n    }\n  };\n\n  const getInitials = (name: string) => {\n    if (!name) return 'U';\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getAvatarColor = (name: string) => {\n    const colors = [\n      'bg-gradient-to-br from-blue-500 to-blue-600',\n      'bg-gradient-to-br from-purple-500 to-purple-600',\n      'bg-gradient-to-br from-green-500 to-green-600',\n      'bg-gradient-to-br from-orange-500 to-orange-600',\n      'bg-gradient-to-br from-pink-500 to-pink-600',\n      'bg-gradient-to-br from-indigo-500 to-indigo-600',\n    ];\n    const index = (name?.charCodeAt(0) || 0) % colors.length;\n    return colors[index];\n  };\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case 'super_admin':\n        return 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 border-amber-200 dark:border-amber-800';\n      case 'owner':\n        return 'bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border-purple-200 dark:border-purple-800';\n      case 'admin':\n        return 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border-red-200 dark:border-red-800';\n      case 'manager':\n        return 'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300 border-indigo-200 dark:border-indigo-800';\n      case 'developer':\n        return 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 border-blue-200 dark:border-blue-800';\n      case 'viewer':\n        return 'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-800';\n      default:\n        return 'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-800';\n    }\n  };\n\n  const getRoleIcon = (role: string) => {\n    switch (role) {\n      case 'super_admin':\n        return <Shield className=\"size-3\" />;\n      case 'owner':\n        return <Crown className=\"size-3\" />;\n      case 'admin':\n        return <Crown className=\"size-3\" />;\n      case 'manager':\n        return <Settings className=\"size-3\" />;\n      case 'developer':\n        return <User className=\"size-3\" />;\n      default:\n        return <User className=\"size-3\" />;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n    });\n  };\n\n  // Check if current user is super_admin, owner or admin\n  // Use the role fetched directly from database to avoid cached state issues\n  const userRole = currentUserRole || user?.user_metadata?.role;\n  const isSuperAdmin = userRole === 'super_admin';\n  const hasAccess = userRole === 'super_admin' || userRole === 'owner' || userRole === 'admin';\n\n  // Show loading while fetching current user's role\n  if (roleLoading) {\n    return <AuthLoadingSkeleton message=\"Loading...\" />;\n  }\n\n  if (!hasAccess) {\n    return (\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 dark:bg-black/70\">\n        <div className=\"w-full max-w-md rounded-2xl bg-white p-8 shadow-2xl dark:bg-slate-800\">\n          <div className=\"text-center\">\n            <Shield className=\"mx-auto mb-4 size-16 text-red-500\" />\n            <h2 className=\"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-100\">\n              Access Denied\n            </h2>\n            <p className=\"mb-6 text-gray-600 dark:text-gray-400\">\n              You need owner or admin privileges to access user management.\n            </p>\n            <Button onClick={onClose} className=\"bg-[var(--primary)] text-white hover:opacity-90\">\n              Go Back\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 dark:bg-black/70\">\n      <div className=\"flex max-h-[90vh] w-full max-w-6xl flex-col overflow-hidden rounded-2xl bg-white shadow-2xl dark:bg-slate-800\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-purple-600 to-indigo-600 p-6 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Users className=\"h-8 w-8\" />\n              <div>\n                <h2 className=\"text-2xl font-bold\">User Management</h2>\n                <p className=\"text-sm text-purple-100\">Manage user roles and permissions</p>\n              </div>\n            </div>\n            <Button\n              onClick={onClose}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"rounded-full text-white hover:bg-white/20\"\n            >\n              <X className=\"size-5\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"border-b border-gray-200 bg-gray-50 p-6 dark:border-slate-700 dark:bg-slate-900/50\">\n          <SearchInput\n            label=\"Search users\"\n            value={searchQuery}\n            onChange={setSearchQuery}\n            placeholder=\"Search by name, email, or role...\"\n          />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {/* Success/Error Messages */}\n          {success && (\n            <Alert className=\"mb-4 border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20\">\n              <AlertDescription className=\"text-green-800 dark:text-green-300\">\n                User role updated successfully!\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {error && (\n            <Alert variant=\"destructive\" className=\"mb-4\">\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n\n          {loading ? (\n            <UserManagementSkeleton count={5} />\n          ) : filteredUsers.length === 0 ? (\n            <div className=\"py-12 text-center\">\n              <Users className=\"mx-auto mb-4 size-16 text-gray-400\" />\n              <h3 className=\"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100\">\n                No users found\n              </h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">\n                {searchQuery ? 'Try a different search term' : 'No users in the system yet'}\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {filteredUsers.map((userProfile) => (\n                <div\n                  key={userProfile.id}\n                  className=\"rounded-xl border border-gray-200 bg-gray-50 p-4 transition-colors hover:border-blue-300 dark:border-slate-700 dark:bg-slate-900 dark:hover:border-blue-700\"\n                >\n                  <div className=\"flex items-center gap-4\">\n                    <Avatar\n                      className={`size-12 ${getAvatarColor(userProfile.name || userProfile.email)} text-white shadow-md`}\n                    >\n                      <AvatarFallback className=\"text-lg font-bold\">\n                        {getInitials(userProfile.name || userProfile.email)}\n                      </AvatarFallback>\n                    </Avatar>\n\n                    <div className=\"min-w-0 flex-1\">\n                      <div className=\"mb-1 flex items-center gap-2\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          {userProfile.name || 'Unnamed User'}\n                        </h3>\n                        {userProfile.id === user?.id && (\n                          <span className=\"rounded-full bg-blue-100 px-2 py-0.5 text-xs text-blue-800 dark:bg-blue-900/30 dark:text-blue-300\">\n                            You\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                        <div className=\"flex items-center gap-1\">\n                          <Mail className=\"size-3\" />\n                          {userProfile.email}\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"size-3\" />\n                          {formatDate(userProfile.createdAt)}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-3\">\n                      <span\n                        className={`flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium ${getRoleBadgeColor(userProfile.role)}`}\n                      >\n                        {getRoleIcon(userProfile.role)}\n                        {userProfile.role.charAt(0).toUpperCase() + userProfile.role.slice(1)}\n                      </span>\n\n                      <Button\n                        onClick={() => handleOpenRoleDialog(userProfile)}\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"gap-1\"\n                      >\n                        <Edit2 className=\"size-3\" />\n                        Edit Role\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer Stats */}\n        <div className=\"border-t border-gray-200 bg-gray-50 px-6 py-4 dark:border-slate-700 dark:bg-slate-900/50\">\n          <div className=\"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400\">\n            <div>\n              Total Users:{' '}\n              <span className=\"font-semibold text-gray-900 dark:text-gray-100\">{users.length}</span>\n            </div>\n            <div className=\"flex flex-wrap gap-4\">\n              {users.some((u) => u.role === 'super_admin') && (\n                <div>\n                  Super Admins:{' '}\n                  <span className=\"font-semibold text-amber-600 dark:text-amber-400\">\n                    {users.filter((u) => u.role === 'super_admin').length}\n                  </span>\n                </div>\n              )}\n              <div>\n                Owners:{' '}\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                  {users.filter((u) => u.role === 'owner').length}\n                </span>\n              </div>\n              <div>\n                Admins:{' '}\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                  {users.filter((u) => u.role === 'admin').length}\n                </span>\n              </div>\n              <div>\n                Managers:{' '}\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                  {users.filter((u) => u.role === 'manager').length}\n                </span>\n              </div>\n              <div>\n                Developers:{' '}\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                  {users.filter((u) => u.role === 'developer').length}\n                </span>\n              </div>\n              <div>\n                Viewers:{' '}\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                  {users.filter((u) => u.role === 'viewer').length}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Edit Role Dialog */}\n      <Dialog open={showRoleDialog} onOpenChange={setShowRoleDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Update User Role</DialogTitle>\n            <DialogDescription>\n              Change the role for {selectedUser?.name || selectedUser?.email}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"py-4\">\n            <Label className=\"mb-2 block text-gray-700 dark:text-gray-300\">Select Role</Label>\n            <Select value={newRole} onValueChange={setNewRole}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {/* Super Admin option - only visible to Super Admins */}\n                {isSuperAdmin && (\n                  <SelectItem value=\"super_admin\">\n                    <div className=\"flex items-center gap-2\">\n                      <Shield className=\"size-4 text-amber-500\" />\n                      Super Admin - Cross-organization access\n                    </div>\n                  </SelectItem>\n                )}\n                <SelectItem value=\"owner\">\n                  <div className=\"flex items-center gap-2\">\n                    <Crown className=\"size-4 text-purple-500\" />\n                    Owner - Full organization control\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"admin\">\n                  <div className=\"flex items-center gap-2\">\n                    <Crown className=\"size-4 text-red-500\" />\n                    Admin - Full access to all features\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"manager\">\n                  <div className=\"flex items-center gap-2\">\n                    <Settings className=\"size-4 text-indigo-500\" />\n                    Manager - Can manage projects and users\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"developer\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"size-4 text-blue-500\" />\n                    Developer - Can create and edit tasks\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"viewer\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"size-4 text-gray-500\" />\n                    Viewer - Read-only access\n                  </div>\n                </SelectItem>\n              </SelectContent>\n            </Select>\n\n            {/* Warning for super_admin assignment */}\n            {newRole === 'super_admin' && (\n              <div className=\"mt-3 rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-950/30\">\n                <p className=\"text-sm text-amber-800 dark:text-amber-200\">\n                  <strong>Warning:</strong> Super Admins have cross-organization access and can view\n                  all data in the system.\n                </p>\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowRoleDialog(false)} disabled={updating}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleUpdateRole}\n              disabled={updating || newRole === selectedUser?.role}\n              className=\"bg-[var(--primary)] text-white hover:opacity-90\"\n            >\n              {updating ? (\n                <>\n                  <Loader2 className=\"mr-2 size-4 animate-spin\" />\n                  Updating...\n                </>\n              ) : (\n                'Update Role'\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n",
        "exports": [
          "UserManagementPage"
        ],
        "imports": [
          "react",
          "@/app/providers",
          "@/components/ui/button",
          "@/components/ui/label",
          "@/components/ui/alert",
          "@/components/ui/forms",
          "lucide-react",
          "@/components/ui/avatar",
          "@/components/ui/dialog",
          "@/components/ui/select",
          "@/components/skeletons"
        ],
        "lineCount": 569
      }
    ],
    "dependencies": [],
    "devDependencies": [],
    "envVars": []
  },
  "architecture": {
    "entryPoints": [
      "AccountManagementPage.tsx"
    ],
    "dataFlow": "Entry -> Processing -> Output",
    "keyDecisions": []
  },
  "compatibility": {
    "framework": "generic",
    "frameworkVersion": "*",
    "dependencies": []
  },
  "metrics": {
    "successRate": 0,
    "applications": 0,
    "successes": 0,
    "failures": 0
  },
  "relatedPatterns": [],
  "source": "manual",
  "isPrivate": false,
  "createdAt": "2026-01-22T23:16:05.270Z",
  "updatedAt": "2026-01-22T23:16:05.270Z"
}